<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="记住你要学习，要努力">
<meta property="og:type" content="website">
<meta property="og:title" content="记点笔记ye~">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="记点笔记ye~">
<meta property="og:description" content="记住你要学习，要努力">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="丁辉滴小窝">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>记点笔记ye~</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">记点笔记ye~</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/06/10/rainbond%E8%BF%81%E7%A7%BB%E6%95%B0%E6%8D%AE%E5%BA%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="丁辉滴小窝">
      <meta itemprop="description" content="记住你要学习，要努力">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记点笔记ye~">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/10/rainbond%E8%BF%81%E7%A7%BB%E6%95%B0%E6%8D%AE%E5%BA%93/" class="post-title-link" itemprop="url">rainbond迁移数据库</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-06-10 17:23:31 / 修改时间：17:26:08" itemprop="dateCreated datePublished" datetime="2022-06-10T17:23:31+08:00">2022-06-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl edit rainbondcluster -n rbd-system #进入修改数据库地址</span><br><span class="line">kubectl delete pod -l name=rainbond-operator -n rbd-system  #重启控制节点</span><br><span class="line">kubectl get pod -l name=rbd-api -n rbd-system -o yaml   #查看是否生效</span><br><span class="line">最重要的一点数据备份</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/06/10/k8s-kubeadm%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="丁辉滴小窝">
      <meta itemprop="description" content="记住你要学习，要努力">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记点笔记ye~">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/10/k8s-kubeadm%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">k8s-kubeadm安装</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-06-10 10:11:16 / 修改时间：17:33:43" itemprop="dateCreated datePublished" datetime="2022-06-10T10:11:16+08:00">2022-06-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="liunx关闭swap分区"><a href="#liunx关闭swap分区" class="headerlink" title="liunx关闭swap分区"></a>liunx关闭swap分区</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# swapon</span><br><span class="line">NAME      TYPE      SIZE USED PRIO</span><br><span class="line">/dev/dm-1 partition 3.9G   0B   -2</span><br><span class="line">[root@master ~]# free -h</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           3.7G        349M        3.1G         11M        266M        3.1G</span><br><span class="line">Swap:          3.9G          0B        3.9G</span><br><span class="line">[root@master ~]# swapoff -a</span><br><span class="line">[root@master ~]# free -h</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           3.7G        346M        3.1G         11M        266M        3.1G</span><br><span class="line">Swap:            0B          0B          0B</span><br><span class="line">[root@master ~]# vi /etc/fstab </span><br><span class="line">[root@master ~]# cat /etc/fstab </span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># /etc/fstab</span><br><span class="line"># Created by anaconda on Fri May 20 11:15:29 2022</span><br><span class="line">#</span><br><span class="line"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;</span><br><span class="line"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span><br><span class="line">#</span><br><span class="line">/dev/mapper/centos-root /                       xfs     defaults        0 0</span><br><span class="line">UUID=323a8374-06c8-4283-995b-1dd408bde9b2 /boot                   xfs     defaults        0 0</span><br><span class="line">#/dev/mapper/centos-swap swap                    swap    defaults        0 0</span><br></pre></td></tr></table></figure>

<h3 id="确保每个节点上-MAC-地址和-product-uuid-的唯一性"><a href="#确保每个节点上-MAC-地址和-product-uuid-的唯一性" class="headerlink" title="确保每个节点上 MAC 地址和 product_uuid 的唯一性"></a>确保每个节点上 MAC 地址和 product_uuid 的唯一性</h3><ul>
<li>你可以使用命令 <code>ip link</code> 或 <code>ifconfig -a</code> 来获取网络接口的 MAC 地址</li>
<li>可以使用 <code>sudo cat /sys/class/dmi/id/product_uuid</code> 命令对 product_uuid 校验</li>
</ul>
<h3 id="允许-iptables-检查桥接流量"><a href="#允许-iptables-检查桥接流量" class="headerlink" title="允许 iptables 检查桥接流量"></a>允许 iptables 检查桥接流量</h3><p>确保 <code>br_netfilter</code> 模块被加载。这一操作可以通过运行 <code>lsmod | grep br_netfilter</code> 来完成。若要显式加载该模块，可执行 <code>sudo modprobe br_netfilter</code>。</p>
<p>为了让你的 Linux 节点上的 iptables 能够正确地查看桥接流量，你需要确保在你的 <code>sysctl</code> 配置中将 <code>net.bridge.bridge-nf-call-iptables</code> 设置为 1。例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/modules-load.d/k8s.conf</span></span><br><span class="line"><span class="string">br_netfilter</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/sysctl.d/k8s.conf</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables = 1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">sudo sysctl --system</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/06/09/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E6%96%B9%E6%A1%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="丁辉滴小窝">
      <meta itemprop="description" content="记住你要学习，要努力">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记点笔记ye~">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/09/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E6%96%B9%E6%A1%88/" class="post-title-link" itemprop="url">性能测试方案</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-06-09 10:29:17 / 修改时间：10:29:29" itemprop="dateCreated datePublished" datetime="2022-06-09T10:29:17+08:00">2022-06-09</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="性能测试方案"><a href="#性能测试方案" class="headerlink" title="性能测试方案"></a>性能测试方案</h2><p><strong>测试环境</strong></p>
<table>
<thead>
<tr>
<th>服务器类型</th>
<th>服务器配置</th>
<th>服务器型号</th>
</tr>
</thead>
<tbody><tr>
<td>阿里云ECS</td>
<td>4c16G 50G +50G</td>
<td>ecs</td>
</tr>
</tbody></table>
<h3 id="磁盘性能测试"><a href="#磁盘性能测试" class="headerlink" title="磁盘性能测试"></a>磁盘性能测试</h3><ul>
<li>直接挂载gfs源数据目录执行测试</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name disktest -it -e SLEEP=0 -v /data/disktest:/data/disktest registry.cn-hangzhou.aliyuncs.com/goodrain/op-tools:v1 bash</span><br></pre></td></tr></table></figure>

<ul>
<li>挂载gfs的volume进行测试</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mount.glusterfs   gfsIP:volume  /opt</span><br><span class="line">docker run --name disktest -it -e SLEEP=0 -v /opt/disktest:/data/disktest registry.cn-hangzhou.aliyuncs.com/goodrain/op-tools:v1 bash</span><br></pre></td></tr></table></figure>

<h4 id="进行测试"><a href="#进行测试" class="headerlink" title="进行测试"></a>进行测试</h4><ul>
<li>随机写</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fio --ioengine=libaio --runtime=300 --numjobs=2 --iodepth=64 --bs=4k --size=2G --rw=randwrite --filename=/data/disktest/test --time_based=1 --direct=1 --name=<span class="built_in">test</span> --group_reporting --cpus_allowed=3 --cpus_allowed_policy=<span class="built_in">split</span></span><br></pre></td></tr></table></figure>

<ul>
<li>顺序写</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fio --ioengine=libaio -runtime=300  --numjobs=2 --iodepth=64 --bs=1024k --size=10G --rw=write --filename=/data/disktest/test --time_based=1 --direct=1 --name=<span class="built_in">test</span> --group_reporting --cpus_allowed=3 --cpus_allowed_policy=<span class="built_in">split</span></span><br></pre></td></tr></table></figure>

<p>Copy</p>
<h4 id="测试结果解读"><a href="#测试结果解读" class="headerlink" title="测试结果解读"></a>测试结果解读</h4><p>直接挂载gfs源数据目录执行测试 </p>
<p>随机(  write: IOPS&#x3D;4291, BW&#x3D;16.8MiB&#x2F;s (17.6MB&#x2F;s)(5029MiB&#x2F;300030msec);   ,  write: IOPS&#x3D;4249, BW&#x3D;16.6MiB&#x2F;s (17.4MB&#x2F;s)(4979MiB&#x2F;300001msec);  )</p>
<p>顺序(  write: IOPS&#x3D;145, BW&#x3D;146MiB&#x2F;s (153MB&#x2F;s)(42.7GiB&#x2F;300647msec);  ,  write: IOPS&#x3D;93, BW&#x3D;93.9MiB&#x2F;s (98.4MB&#x2F;s)(27.5GiB&#x2F;300195msec);  )</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_51486343/article/details/114363140?utm_source=app&app_version=5.3.1&code=app_1562916241&uLinkId=usr1mkqgl919blen">(12条消息) 一步步教你部署 GFS 分布式存储平台（图文详解！）_Xucf1的博客-CSDN博客</a></p>
<h4 id="OLTP读写混合场景压测"><a href="#OLTP读写混合场景压测" class="headerlink" title="OLTP读写混合场景压测"></a>OLTP读写混合场景压测</h4><p><strong>测试过程</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##准备数据</span></span><br><span class="line">sysbench --db-driver=mysql --mysql-host=127.0.0.1 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300  --threads=10 oltp_read_write prepare</span><br><span class="line"></span><br><span class="line"><span class="comment">##运行workload</span></span><br><span class="line">sysbench --db-driver=mysql --mysql-host=127.0.0.1 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300  --threads=10 --percentile=95 --report-interval=5 oltp_read_write run</span><br><span class="line"></span><br><span class="line"><span class="comment">##清理数据</span></span><br><span class="line">sysbench --db-driver=mysql --mysql-host=127.0.0.1 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300  --threads=10 --percentile=95  oltp_read_write cleanup</span><br></pre></td></tr></table></figure>

<p>其中，测试模式为读写混合，使用了10个表，每个表有50万条数据，客户端的并发线程数为10，执行时间为300秒，每5秒生成一次报告。</p>
<p>mysql</p>
<p>1G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            331618</span><br><span class="line">        write:                           34711</span><br><span class="line">        other:                           107347</span><br><span class="line">        total:                           473676</span><br><span class="line">    transactions:                        23655  (78.84 per sec.)</span><br><span class="line">    queries:                             473676 (1578.73 per sec.)</span><br><span class="line">    ignored errors:                      32     (0.11 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>2G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            367192</span><br><span class="line">        write:                           39696</span><br><span class="line">        other:                           117626</span><br><span class="line">        total:                           524514</span><br><span class="line">    transactions:                        26205  (87.32 per sec.)</span><br><span class="line">    queries:                             524514 (1747.84 per sec.)</span><br><span class="line">    ignored errors:                      23     (0.08 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>4G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            372778</span><br><span class="line">        write:                           40316</span><br><span class="line">        other:                           119392</span><br><span class="line">        total:                           532486</span><br><span class="line">    transactions:                        26600  (88.63 per sec.)</span><br><span class="line">    queries:                             532486 (1774.29 per sec.)</span><br><span class="line">    ignored errors:                      27     (0.09 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<h4 id="OLTP只读场景压测"><a href="#OLTP只读场景压测" class="headerlink" title="OLTP只读场景压测"></a>OLTP只读场景压测</h4><p><strong>测试过程</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##准备数据</span></span><br><span class="line">sysbench --db-driver=mysql --mysql-host=127.0.0.1 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300  --threads=10  oltp_read_only prepare</span><br><span class="line"></span><br><span class="line"><span class="comment">##运行workload</span></span><br><span class="line">sysbench --db-driver=mysql --mysql-host=127.0.0.1 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300  --threads=10 --percentile=95 --skip-trx=1 --report-interval=5 oltp_read_only run</span><br><span class="line"></span><br><span class="line"><span class="comment">##清理数据</span></span><br><span class="line">sysbench --db-driver=mysql --mysql-host=127.0.0.1 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300   --threads=10 --percentile=95 oltp_read_only cleanup</span><br></pre></td></tr></table></figure>

<p>1G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            590590</span><br><span class="line">        write:                           0</span><br><span class="line">        other:                           0</span><br><span class="line">        total:                           590590</span><br><span class="line">    transactions:                        42185  (140.57 per sec.)</span><br><span class="line">    queries:                             590590 (1968.00 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>2G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            586712</span><br><span class="line">        write:                           0</span><br><span class="line">        other:                           0</span><br><span class="line">        total:                           586712</span><br><span class="line">    transactions:                        41908  (139.65 per sec.)</span><br><span class="line">    queries:                             586712 (1955.06 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>4G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            589470</span><br><span class="line">        write:                           0</span><br><span class="line">        other:                           0</span><br><span class="line">        total:                           589470</span><br><span class="line">    transactions:                        42105  (140.30 per sec.)</span><br><span class="line">    queries:                             589470 (1964.25 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<h4 id="OLTP只写场景压测"><a href="#OLTP只写场景压测" class="headerlink" title="OLTP只写场景压测"></a>OLTP只写场景压测</h4><p><strong>测试过程</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##准备数据</span></span><br><span class="line">sysbench --db-driver=mysql --mysql-host=127.0.0.1 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300  --threads=10  oltp_write_only prepare</span><br><span class="line"></span><br><span class="line"><span class="comment">##运行workload</span></span><br><span class="line">sysbench --db-driver=mysql --mysql-host=127.0.0.1 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300   --threads=10 --percentile=95 --report-interval=5 oltp_write_only run</span><br><span class="line"></span><br><span class="line"><span class="comment">##清理数据</span></span><br><span class="line">sysbench --db-driver=mysql --mysql-host=127.0.0.1 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300   --threads=10 --percentile=95  oltp_write_only cleanup</span><br></pre></td></tr></table></figure>

<p>1G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            0</span><br><span class="line">        write:                           185094</span><br><span class="line">        other:                           321760</span><br><span class="line">        total:                           506854</span><br><span class="line">    transactions:                        84437  (281.44 per sec.)</span><br><span class="line">    queries:                             506854 (1689.43 per sec.)</span><br><span class="line">    ignored errors:                      58     (0.19 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>2G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            0</span><br><span class="line">        write:                           194780</span><br><span class="line">        other:                           332602</span><br><span class="line">        total:                           527382</span><br><span class="line">    transactions:                        87871  (292.85 per sec.)</span><br><span class="line">    queries:                             527382 (1757.65 per sec.)</span><br><span class="line">    ignored errors:                      39     (0.13 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>4G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            0</span><br><span class="line">        write:                           175814</span><br><span class="line">        other:                           311582</span><br><span class="line">        total:                           487396</span><br><span class="line">    transactions:                        81196  (270.64 per sec.)</span><br><span class="line">    queries:                             487396 (1624.56 per sec.)</span><br><span class="line">    ignored errors:                      55     (0.18 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<h4 id="抹除环境限制"><a href="#抹除环境限制" class="headerlink" title="抹除环境限制"></a>抹除环境限制</h4><h4 id="OLTP读写混合场景压测-1"><a href="#OLTP读写混合场景压测-1" class="headerlink" title="OLTP读写混合场景压测"></a>OLTP读写混合场景压测</h4><p><strong>测试过程</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sysbench --db-driver=mysql  --mysql-user=root --mysql-password=yes --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300  --threads=10 oltp_read_write prepare</span><br><span class="line"></span><br><span class="line">sysbench --db-driver=mysql  --mysql-user=root --mysql-password=yes --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300  --threads=10 --percentile=95 --report-interval=5 oltp_read_write run</span><br><span class="line"></span><br><span class="line">sysbench --db-driver=mysql  --mysql-user=root --mysql-password=yes --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300  --threads=10 --percentile=95  oltp_read_write cleanup</span><br></pre></td></tr></table></figure>

<p>1G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            966112</span><br><span class="line">        write:                           276032</span><br><span class="line">        other:                           138016</span><br><span class="line">        total:                           1380160</span><br><span class="line">    transactions:                        69008  (230.01 per sec.)</span><br><span class="line">    queries:                             1380160 (4600.22 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>2G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            1041796</span><br><span class="line">        write:                           297656</span><br><span class="line">        other:                           148828</span><br><span class="line">        total:                           1488280</span><br><span class="line">    transactions:                        74414  (248.01 per sec.)</span><br><span class="line">    queries:                             1488280 (4960.12 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>4G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            1104166</span><br><span class="line">        write:                           315476</span><br><span class="line">        other:                           157738</span><br><span class="line">        total:                           1577380</span><br><span class="line">    transactions:                        78869  (262.84 per sec.)</span><br><span class="line">    queries:                             1577380 (5256.70 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>



<h4 id="OLTP只读场景压测-1"><a href="#OLTP只读场景压测-1" class="headerlink" title="OLTP只读场景压测"></a>OLTP只读场景压测</h4><p><strong>测试过程</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sysbench --db-driver=mysql  --mysql-user=root --mysql-password=yes --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300  --threads=10  oltp_read_only prepare</span><br><span class="line"></span><br><span class="line">sysbench --db-driver=mysql  --mysql-user=root --mysql-password=yes --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300  --threads=10 --percentile=95 --skip-trx=1 --report-interval=5 oltp_read_only run</span><br><span class="line"></span><br><span class="line">sysbench --db-driver=mysql  --mysql-user=root --mysql-password=yes --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300   --threads=10 --percentile=95 oltp_read_only cleanup</span><br></pre></td></tr></table></figure>

<p>1G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            8189552</span><br><span class="line">        write:                           0</span><br><span class="line">        other:                           0</span><br><span class="line">        total:                           8189552</span><br><span class="line">    transactions:                        584968 (1949.82 per sec.)</span><br><span class="line">    queries:                             8189552 (27297.51 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>2G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            8503824</span><br><span class="line">        write:                           0</span><br><span class="line">        other:                           0</span><br><span class="line">        total:                           8503824</span><br><span class="line">    transactions:                        607416 (2024.65 per sec.)</span><br><span class="line">    queries:                             8503824 (28345.14 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>4G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            8557640</span><br><span class="line">        write:                           0</span><br><span class="line">        other:                           0</span><br><span class="line">        total:                           8557640</span><br><span class="line">    transactions:                        611260 (2037.46 per sec.)</span><br><span class="line">    queries:                             8557640 (28524.40 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>



<h4 id="OLTP只写场景压测-1"><a href="#OLTP只写场景压测-1" class="headerlink" title="OLTP只写场景压测"></a>OLTP只写场景压测</h4><p><strong>测试过程</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sysbench --db-driver=mysql  --mysql-user=root --mysql-password=yes --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300  --threads=10  oltp_write_only prepare</span><br><span class="line"></span><br><span class="line">sysbench --db-driver=mysql  --mysql-user=root --mysql-password=yes --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300   --threads=10 --percentile=95 --report-interval=5 oltp_write_only run</span><br><span class="line"></span><br><span class="line">sysbench --db-driver=mysql  --mysql-user=root --mysql-password=yes --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300   --threads=10 --percentile=95  oltp_write_only cleanup</span><br></pre></td></tr></table></figure>

<p>1G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            0</span><br><span class="line">        write:                           686296</span><br><span class="line">        other:                           343148</span><br><span class="line">        total:                           1029444</span><br><span class="line">    transactions:                        171574 (571.87 per sec.)</span><br><span class="line">    queries:                             1029444 (3431.19 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>2G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            0</span><br><span class="line">        write:                           746788</span><br><span class="line">        other:                           373394</span><br><span class="line">        total:                           1120182</span><br><span class="line">    transactions:                        186697 (622.28 per sec.)</span><br><span class="line">    queries:                             1120182 (3733.67 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>4G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            0</span><br><span class="line">        write:                           753064</span><br><span class="line">        other:                           376532</span><br><span class="line">        total:                           1129596</span><br><span class="line">    transactions:                        188266 (627.53 per sec.)</span><br><span class="line">    queries:                             1129596 (3765.16 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>



<h1 id="ceph测试"><a href="#ceph测试" class="headerlink" title="ceph测试"></a>ceph测试</h1><p>随机</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IOPS=2166, BW=8664KiB/s (8872kB/s)(2539MiB/300030msec);</span><br></pre></td></tr></table></figure>

<p>顺序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IOPS=107, BW=108MiB/s (113MB/s)(31.7GiB/301172msec);</span><br></pre></td></tr></table></figure>

<p>随机</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IOPS=4283, BW=16.7MiB/s (17.5MB/s)(5020MiB/300026msec);</span><br></pre></td></tr></table></figure>

<p>顺序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">write: IOPS=126, BW=127MiB/s (133MB/s)(37.2GiB/300774msec);</span><br></pre></td></tr></table></figure>

<h3 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h3><p>共享存储</p>
<h4 id="OLTP读写混合场景压测-2"><a href="#OLTP读写混合场景压测-2" class="headerlink" title="OLTP读写混合场景压测"></a>OLTP读写混合场景压测</h4><p><strong>测试过程</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##准备数据</span></span><br><span class="line">sysbench --db-driver=mysql --mysql-host=127.0.0.1 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300  --threads=10 oltp_read_write prepare</span><br><span class="line"></span><br><span class="line"><span class="comment">##运行workload</span></span><br><span class="line">sysbench --db-driver=mysql --mysql-host=127.0.0.1 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300  --threads=10 --percentile=95 --report-interval=5 oltp_read_write run</span><br><span class="line"></span><br><span class="line"><span class="comment">##清理数据</span></span><br><span class="line">sysbench --db-driver=mysql --mysql-host=127.0.0.1 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300  --threads=10 --percentile=95  oltp_read_write cleanup</span><br></pre></td></tr></table></figure>

<p>1G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            372638</span><br><span class="line">        write:                           40345</span><br><span class="line">        other:                           119319</span><br><span class="line">        total:                           532302</span><br><span class="line">    transactions:                        26598  (88.63 per sec.)</span><br><span class="line">    queries:                             532302 (1773.71 per sec.)</span><br><span class="line">    ignored errors:                      19     (0.06 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>2G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            303366</span><br><span class="line">        write:                           30966</span><br><span class="line">        other:                           98998</span><br><span class="line">        total:                           433330</span><br><span class="line">    transactions:                        21644  (72.12 per sec.)</span><br><span class="line">    queries:                             433330 (1443.95 per sec.)</span><br><span class="line">    ignored errors:                      25     (0.08 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>4G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            309008</span><br><span class="line">        write:                           31923</span><br><span class="line">        other:                           100449</span><br><span class="line">        total:                           441380</span><br><span class="line">    transactions:                        22042  (73.45 per sec.)</span><br><span class="line">    queries:                             441380 (1470.74 per sec.)</span><br><span class="line">    ignored errors:                      30     (0.10 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<h4 id="OLTP只读场景压测-2"><a href="#OLTP只读场景压测-2" class="headerlink" title="OLTP只读场景压测"></a>OLTP只读场景压测</h4><p><strong>测试过程</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##准备数据</span></span><br><span class="line">sysbench --db-driver=mysql --mysql-host=127.0.0.1 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300  --threads=10  oltp_read_only prepare</span><br><span class="line"></span><br><span class="line"><span class="comment">##运行workload</span></span><br><span class="line">sysbench --db-driver=mysql --mysql-host=127.0.0.1 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300  --threads=10 --percentile=95 --skip-trx=1 --report-interval=5 oltp_read_only run</span><br><span class="line"></span><br><span class="line"><span class="comment">##清理数据</span></span><br><span class="line">sysbench --db-driver=mysql --mysql-host=127.0.0.1 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300   --threads=10 --percentile=95 oltp_read_only cleanup</span><br></pre></td></tr></table></figure>

<p>1G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            605920</span><br><span class="line">        write:                           0</span><br><span class="line">        other:                           0</span><br><span class="line">        total:                           605920</span><br><span class="line">    transactions:                        43280  (144.22 per sec.)</span><br><span class="line">    queries:                             605920 (2019.04 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>2G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            445886</span><br><span class="line">        write:                           0</span><br><span class="line">        other:                           0</span><br><span class="line">        total:                           445886</span><br><span class="line">    transactions:                        31849  (106.13 per sec.)</span><br><span class="line">    queries:                             445886 (1485.79 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>4G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            449106</span><br><span class="line">        write:                           0</span><br><span class="line">        other:                           0</span><br><span class="line">        total:                           449106</span><br><span class="line">    transactions:                        32079  (106.89 per sec.)</span><br><span class="line">    queries:                             449106 (1496.51 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<h4 id="OLTP只写场景压测-2"><a href="#OLTP只写场景压测-2" class="headerlink" title="OLTP只写场景压测"></a>OLTP只写场景压测</h4><p><strong>测试过程</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##准备数据</span></span><br><span class="line">sysbench --db-driver=mysql --mysql-host=127.0.0.1 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300  --threads=10  oltp_write_only prepare</span><br><span class="line"></span><br><span class="line"><span class="comment">##运行workload</span></span><br><span class="line">sysbench --db-driver=mysql --mysql-host=127.0.0.1 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300   --threads=10 --percentile=95 --report-interval=5 oltp_write_only run</span><br><span class="line"></span><br><span class="line"><span class="comment">##清理数据</span></span><br><span class="line">sysbench --db-driver=mysql --mysql-host=127.0.0.1 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300   --threads=10 --percentile=95  oltp_write_only cleanup</span><br></pre></td></tr></table></figure>

<p>1G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            0</span><br><span class="line">        write:                           142501</span><br><span class="line">        other:                           273633</span><br><span class="line">        total:                           416134</span><br><span class="line">    transactions:                        69327  (231.07 per sec.)</span><br><span class="line">    queries:                             416134 (1387.01 per sec.)</span><br><span class="line">    ignored errors:                      43     (0.14 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>2G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            0</span><br><span class="line">        write:                           179521</span><br><span class="line">        other:                           315923</span><br><span class="line">        total:                           495444</span><br><span class="line">    transactions:                        82536  (275.11 per sec.)</span><br><span class="line">    queries:                             495444 (1651.41 per sec.)</span><br><span class="line">    ignored errors:                      57     (0.19 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>4G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            0</span><br><span class="line">        write:                           156854</span><br><span class="line">        other:                           289920</span><br><span class="line">        total:                           446774</span><br><span class="line">    transactions:                        74431  (248.09 per sec.)</span><br><span class="line">    queries:                             446774 (1489.19 per sec.)</span><br><span class="line">    ignored errors:                      47     (0.16 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<h3 id="限制解除"><a href="#限制解除" class="headerlink" title="限制解除"></a>限制解除</h3><h4 id="OLTP读写混合场景压测-3"><a href="#OLTP读写混合场景压测-3" class="headerlink" title="OLTP读写混合场景压测"></a>OLTP读写混合场景压测</h4><p><strong>测试过程</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##准备数据</span></span><br><span class="line">sysbench --db-driver=mysql  --mysql-user=root --mysql-password=<span class="built_in">yes</span> --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300  --threads=10 oltp_read_write prepare</span><br><span class="line"></span><br><span class="line"><span class="comment">##运行workload</span></span><br><span class="line">sysbench --db-driver=mysql  --mysql-user=root --mysql-password=<span class="built_in">yes</span> --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300  --threads=10 --percentile=95 --report-interval=5 oltp_read_write run</span><br><span class="line"></span><br><span class="line"><span class="comment">##清理数据</span></span><br><span class="line">sysbench --db-driver=mysql  --mysql-user=root --mysql-password=<span class="built_in">yes</span> --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300  --threads=10 --percentile=95  oltp_read_write cleanup</span><br></pre></td></tr></table></figure>

<p>1G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            3800258</span><br><span class="line">        write:                           781292</span><br><span class="line">        other:                           847384</span><br><span class="line">        total:                           5428934</span><br><span class="line">    transactions:                        271444 (904.74 per sec.)</span><br><span class="line">    queries:                             5428934 (18095.08 per sec.)</span><br><span class="line">    ignored errors:                      3      (0.01 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>2G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            3878210</span><br><span class="line">        write:                           800158</span><br><span class="line">        other:                           861924</span><br><span class="line">        total:                           5540292</span><br><span class="line">    transactions:                        277011 (923.33 per sec.)</span><br><span class="line">    queries:                             5540292 (18466.87 per sec.)</span><br><span class="line">    ignored errors:                      4      (0.01 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>4G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            3865974</span><br><span class="line">        write:                           797525</span><br><span class="line">        other:                           859307</span><br><span class="line">        total:                           5522806</span><br><span class="line">    transactions:                        276134 (920.41 per sec.)</span><br><span class="line">    queries:                             5522806 (18408.52 per sec.)</span><br><span class="line">    ignored errors:                      7      (0.02 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<h4 id="OLTP只读场景压测-3"><a href="#OLTP只读场景压测-3" class="headerlink" title="OLTP只读场景压测"></a>OLTP只读场景压测</h4><p><strong>测试过程</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##准备数据</span></span><br><span class="line">sysbench --db-driver=mysql  --mysql-user=root --mysql-password=<span class="built_in">yes</span> --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300  --threads=10  oltp_read_only prepare</span><br><span class="line"></span><br><span class="line"><span class="comment">##运行workload</span></span><br><span class="line">sysbench --db-driver=mysql  --mysql-user=root --mysql-password=<span class="built_in">yes</span> --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300  --threads=10 --percentile=95 --skip-trx=1 --report-interval=5 oltp_read_only run</span><br><span class="line"></span><br><span class="line"><span class="comment">##清理数据</span></span><br><span class="line">sysbench --db-driver=mysql  --mysql-user=root --mysql-password=<span class="built_in">yes</span> --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300   --threads=10 --percentile=95 oltp_read_only cleanup</span><br></pre></td></tr></table></figure>

<p>1G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            14018718</span><br><span class="line">        write:                           0</span><br><span class="line">        other:                           0</span><br><span class="line">        total:                           14018718</span><br><span class="line">    transactions:                        1001337 (3337.67 per sec.)</span><br><span class="line">    queries:                             14018718 (46727.40 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>2G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[ 300s ] thds: 10 tps: 3398.67 qps: 47580.78 (r/w/o: 47580.78/0.00/0.00) lat (ms,95%): 6.09 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            13890100</span><br><span class="line">        write:                           0</span><br><span class="line">        other:                           0</span><br><span class="line">        total:                           13890100</span><br><span class="line">    transactions:                        992150 (3307.04 per sec.)</span><br><span class="line">    queries:                             13890100 (46298.51 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>4G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            13985034</span><br><span class="line">        write:                           0</span><br><span class="line">        other:                           0</span><br><span class="line">        total:                           13985034</span><br><span class="line">    transactions:                        998931 (3329.63 per sec.)</span><br><span class="line">    queries:                             13985034 (46614.81 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<h4 id="OLTP只写场景压测-3"><a href="#OLTP只写场景压测-3" class="headerlink" title="OLTP只写场景压测"></a>OLTP只写场景压测</h4><p><strong>测试过程</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##准备数据</span></span><br><span class="line">sysbench --db-driver=mysql  --mysql-user=root --mysql-password=<span class="built_in">yes</span> --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300  --threads=10  oltp_write_only prepare</span><br><span class="line"></span><br><span class="line"><span class="comment">##运行workload</span></span><br><span class="line">sysbench --db-driver=mysql  --mysql-user=root --mysql-password=<span class="built_in">yes</span> --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300   --threads=10 --percentile=95 --report-interval=5 oltp_write_only run</span><br><span class="line"></span><br><span class="line"><span class="comment">##清理数据</span></span><br><span class="line">sysbench --db-driver=mysql  --mysql-user=root --mysql-password=<span class="built_in">yes</span> --mysql-db=sbtest --table_size=500000 --tables=10 --events=0 --time=300   --threads=10 --percentile=95  oltp_write_only cleanup</span><br></pre></td></tr></table></figure>

<p>1G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            0</span><br><span class="line">        write:                           1547318</span><br><span class="line">        other:                           1464122</span><br><span class="line">        total:                           3011440</span><br><span class="line">    transactions:                        501898 (1672.94 per sec.)</span><br><span class="line">    queries:                             3011440 (10037.80 per sec.)</span><br><span class="line">    ignored errors:                      13     (0.04 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>2G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[ 300s ] thds: 10 tps: 1612.65 qps: 9679.10 (r/w/o: 0.00/5372.17/4306.93) lat (ms,95%): 13.70 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            0</span><br><span class="line">        write:                           1557953</span><br><span class="line">        other:                           1474303</span><br><span class="line">        total:                           3032256</span><br><span class="line">    transactions:                        505366 (1684.47 per sec.)</span><br><span class="line">    queries:                             3032256 (10107.03 per sec.)</span><br><span class="line">    ignored errors:                      15     (0.05 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>4G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            0</span><br><span class="line">        write:                           1539543</span><br><span class="line">        other:                           1458921</span><br><span class="line">        total:                           2998464</span><br><span class="line">    transactions:                        499736 (1665.49 per sec.)</span><br><span class="line">    queries:                             2998464 (9993.07 per sec.)</span><br><span class="line">    ignored errors:                      12     (0.04 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<h3 id="块存储："><a href="#块存储：" class="headerlink" title="块存储："></a>块存储：</h3><p>F1:</p>
<p>1G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            318262</span><br><span class="line">        write:                           33000</span><br><span class="line">        other:                           103362</span><br><span class="line">        total:                           454624</span><br><span class="line">    transactions:                        22715  (75.67 per sec.)</span><br><span class="line">    queries:                             454624 (1514.46 per sec.)</span><br><span class="line">    ignored errors:                      18     (0.06 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>2G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            316848</span><br><span class="line">        write:                           32805</span><br><span class="line">        other:                           102965</span><br><span class="line">        total:                           452618</span><br><span class="line">    transactions:                        22621  (75.38 per sec.)</span><br><span class="line">    queries:                             452618 (1508.18 per sec.)</span><br><span class="line">    ignored errors:                      11     (0.04 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>4G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            347284</span><br><span class="line">        write:                           36899</span><br><span class="line">        other:                           111913</span><br><span class="line">        total:                           496096</span><br><span class="line">    transactions:                        24794  (82.62 per sec.)</span><br><span class="line">    queries:                             496096 (1653.10 per sec.)</span><br><span class="line">    ignored errors:                      12     (0.04 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>H:</p>
<p>1G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            5219242</span><br><span class="line">        write:                           1117957</span><br><span class="line">        other:                           1118855</span><br><span class="line">        total:                           7456054</span><br><span class="line">    transactions:                        372800 (1242.62 per sec.)</span><br><span class="line">    queries:                             7456054 (24852.58 per sec.)</span><br><span class="line">    ignored errors:                      3      (0.01 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>2G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            5106248</span><br><span class="line">        write:                           1089663</span><br><span class="line">        other:                           1098719</span><br><span class="line">        total:                           7294630</span><br><span class="line">    transactions:                        364727 (1215.68 per sec.)</span><br><span class="line">    queries:                             7294630 (24313.80 per sec.)</span><br><span class="line">    ignored errors:                      5      (0.02 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>4G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            5110322</span><br><span class="line">        write:                           1091122</span><br><span class="line">        other:                           1099006</span><br><span class="line">        total:                           7300450</span><br><span class="line">    transactions:                        365018 (1216.68 per sec.)</span><br><span class="line">    queries:                             7300450 (24333.92 per sec.)</span><br><span class="line">    ignored errors:                      5      (0.02 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>





<p>F2:</p>
<p>1G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            485744</span><br><span class="line">        write:                           0</span><br><span class="line">        other:                           0</span><br><span class="line">        total:                           485744</span><br><span class="line">    transactions:                        34696  (115.62 per sec.)</span><br><span class="line">    queries:                             485744 (1618.67 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>2G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            499100</span><br><span class="line">        write:                           0</span><br><span class="line">        other:                           0</span><br><span class="line">        total:                           499100</span><br><span class="line">    transactions:                        35650  (118.79 per sec.)</span><br><span class="line">    queries:                             499100 (1663.10 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>4G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            483476</span><br><span class="line">        write:                           0</span><br><span class="line">        other:                           0</span><br><span class="line">        total:                           483476</span><br><span class="line">    transactions:                        34534  (115.11 per sec.)</span><br><span class="line">    queries:                             483476 (1611.50 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>H:</p>
<p>1G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            14361004</span><br><span class="line">        write:                           0</span><br><span class="line">        other:                           0</span><br><span class="line">        total:                           14361004</span><br><span class="line">    transactions:                        1025786 (3419.19 per sec.)</span><br><span class="line">    queries:                             14361004 (47868.63 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>2G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            14339066</span><br><span class="line">        write:                           0</span><br><span class="line">        other:                           0</span><br><span class="line">        total:                           14339066</span><br><span class="line">    transactions:                        1024219 (3413.98 per sec.)</span><br><span class="line">    queries:                             14339066 (47795.73 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>4G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            14150724</span><br><span class="line">        write:                           0</span><br><span class="line">        other:                           0</span><br><span class="line">        total:                           14150724</span><br><span class="line">    transactions:                        1010766 (3369.09 per sec.)</span><br><span class="line">    queries:                             14150724 (47167.30 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>





<p>F3:</p>
<p>1G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            0</span><br><span class="line">        write:                           161560</span><br><span class="line">        other:                           295832</span><br><span class="line">        total:                           457392</span><br><span class="line">    transactions:                        76196  (253.98 per sec.)</span><br><span class="line">    queries:                             457392 (1524.59 per sec.)</span><br><span class="line">    ignored errors:                      54     (0.18 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>2G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            0</span><br><span class="line">        write:                           156234</span><br><span class="line">        other:                           290646</span><br><span class="line">        total:                           446880</span><br><span class="line">    transactions:                        74438  (248.05 per sec.)</span><br><span class="line">    queries:                             446880 (1489.15 per sec.)</span><br><span class="line">    ignored errors:                      63     (0.21 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>4G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            0</span><br><span class="line">        write:                           160065</span><br><span class="line">        other:                           293057</span><br><span class="line">        total:                           453122</span><br><span class="line">    transactions:                        75485  (251.61 per sec.)</span><br><span class="line">    queries:                             453122 (1510.36 per sec.)</span><br><span class="line">    ignored errors:                      53     (0.18 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>H:</p>
<p>1G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            0</span><br><span class="line">        write:                           2523282</span><br><span class="line">        other:                           2238234</span><br><span class="line">        total:                           4761516</span><br><span class="line">    transactions:                        793572 (2645.17 per sec.)</span><br><span class="line">    queries:                             4761516 (15871.30 per sec.)</span><br><span class="line">    ignored errors:                      21     (0.07 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>2G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            0</span><br><span class="line">        write:                           2534569</span><br><span class="line">        other:                           2246533</span><br><span class="line">        total:                           4781102</span><br><span class="line">    transactions:                        796837 (2656.03 per sec.)</span><br><span class="line">    queries:                             4781102 (15936.48 per sec.)</span><br><span class="line">    ignored errors:                      20     (0.07 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>

<p>4G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            0</span><br><span class="line">        write:                           2531541</span><br><span class="line">        other:                           2245569</span><br><span class="line">        total:                           4777110</span><br><span class="line">    transactions:                        796167 (2653.80 per sec.)</span><br><span class="line">    queries:                             4777110 (15923.18 per sec.)</span><br><span class="line">    ignored errors:                      27     (0.09 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/06/09/ceph%E5%92%8Cgfs%E5%AF%B9%E6%AF%94%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="丁辉滴小窝">
      <meta itemprop="description" content="记住你要学习，要努力">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记点笔记ye~">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/09/ceph%E5%92%8Cgfs%E5%AF%B9%E6%AF%94%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C/" class="post-title-link" itemprop="url">ceph和gfs对比测试结果</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-06-09 10:28:13 / 修改时间：10:28:29" itemprop="dateCreated datePublished" datetime="2022-06-09T10:28:13+08:00">2022-06-09</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h5 id="存储性能测试"><a href="#存储性能测试" class="headerlink" title="存储性能测试"></a>存储性能测试</h5><table>
<thead>
<tr>
<th>测试项目</th>
<th>随机写<strong>（IOPS）</strong></th>
<th>顺序写<strong>（吞吐量）</strong></th>
</tr>
</thead>
<tbody><tr>
<td>&#x2F;data    （本地磁盘测试）</td>
<td>4291</td>
<td>146MiB</td>
</tr>
<tr>
<td>gfs        （gfs卷挂载到本地测试）</td>
<td>4249</td>
<td>93.9MiB</td>
</tr>
<tr>
<td>ceph    （ceph挂载到本地测试）</td>
<td>4283</td>
<td>127MiB</td>
</tr>
</tbody></table>
<h2 id="分配1G内存测试"><a href="#分配1G内存测试" class="headerlink" title="分配1G内存测试"></a>分配1G内存测试</h2><h4 id="数据库读写性能测试"><a href="#数据库读写性能测试" class="headerlink" title="数据库读写性能测试"></a>数据库读写性能测试</h4><table>
<thead>
<tr>
<th>正常rainbond创建组件测试</th>
<th>内存</th>
<th>QPS</th>
<th>RT</th>
</tr>
</thead>
<tbody><tr>
<td>gfs</td>
<td>1G</td>
<td>1578.73</td>
<td>78.84</td>
</tr>
<tr>
<td>cephfs</td>
<td>1G</td>
<td>1773.71</td>
<td>88.63</td>
</tr>
<tr>
<td>ceph-block</td>
<td>1G</td>
<td>1514.46</td>
<td>75.67</td>
</tr>
<tr>
<td>消除rainbond组件环境限制</td>
<td>内存</td>
<td>QPS</td>
<td>RT</td>
</tr>
<tr>
<td>gfs</td>
<td>1G</td>
<td>4600.22</td>
<td>230.01</td>
</tr>
<tr>
<td>ceph</td>
<td>1G</td>
<td>18095.08</td>
<td>904.74</td>
</tr>
<tr>
<td>ceph-block</td>
<td>1G</td>
<td>24852.58</td>
<td>1242.62</td>
</tr>
</tbody></table>
<h4 id="数据库只读性能测试"><a href="#数据库只读性能测试" class="headerlink" title="数据库只读性能测试"></a>数据库只读性能测试</h4><table>
<thead>
<tr>
<th>正常rainbond创建组件测试</th>
<th>内存</th>
<th>QPS</th>
<th>RT</th>
</tr>
</thead>
<tbody><tr>
<td>gfs</td>
<td>1G</td>
<td>1968</td>
<td>140.57</td>
</tr>
<tr>
<td>cephfs</td>
<td>1G</td>
<td>2019.04</td>
<td>144.22</td>
</tr>
<tr>
<td>ceph-block</td>
<td>1G</td>
<td>1618.67</td>
<td>115.62</td>
</tr>
<tr>
<td>消除rainbond组件环境限制</td>
<td>内存</td>
<td>QPS</td>
<td>RT</td>
</tr>
<tr>
<td>gfs</td>
<td>1G</td>
<td>27297.51</td>
<td>1949.82</td>
</tr>
<tr>
<td>cephfs</td>
<td>1G</td>
<td>46727.40</td>
<td>3337.67</td>
</tr>
<tr>
<td>ceph-block</td>
<td>1G</td>
<td>47868.63</td>
<td>3419.19</td>
</tr>
</tbody></table>
<h4 id="数据库只写性能测试"><a href="#数据库只写性能测试" class="headerlink" title="数据库只写性能测试"></a>数据库只写性能测试</h4><table>
<thead>
<tr>
<th>正常rainbond创建组件测试</th>
<th>内存</th>
<th>TPS</th>
<th>RT</th>
</tr>
</thead>
<tbody><tr>
<td>gfs</td>
<td>1G</td>
<td>1689.43</td>
<td>281.44</td>
</tr>
<tr>
<td>cephfs</td>
<td>1G</td>
<td>1387.01</td>
<td>231.07</td>
</tr>
<tr>
<td>ceph-block</td>
<td>1G</td>
<td>1524.59</td>
<td>253.98</td>
</tr>
<tr>
<td>消除rainbond组件环境限制</td>
<td>内存</td>
<td>TPS</td>
<td>RT</td>
</tr>
<tr>
<td>gfs</td>
<td>1G</td>
<td>3431.19</td>
<td>571.87</td>
</tr>
<tr>
<td>cephfs</td>
<td>1G</td>
<td>10037.80</td>
<td>1672.94</td>
</tr>
<tr>
<td>ceph-block</td>
<td>1G</td>
<td>15871.30</td>
<td>2645.17</td>
</tr>
</tbody></table>
<h2 id="分配2G内存测试"><a href="#分配2G内存测试" class="headerlink" title="分配2G内存测试"></a>分配2G内存测试</h2><h4 id="数据库读写性能测试-1"><a href="#数据库读写性能测试-1" class="headerlink" title="数据库读写性能测试"></a>数据库读写性能测试</h4><table>
<thead>
<tr>
<th>正常rainbond创建组件测试</th>
<th>内存</th>
<th>QPS</th>
<th>RT</th>
</tr>
</thead>
<tbody><tr>
<td>gfs</td>
<td>2G</td>
<td>1747.84</td>
<td>87.32</td>
</tr>
<tr>
<td>cephfs</td>
<td>2G</td>
<td>1443.95</td>
<td>72.12</td>
</tr>
<tr>
<td>ceph-block</td>
<td>2G</td>
<td>1508.18</td>
<td>75.38</td>
</tr>
<tr>
<td>消除rainbond组件环境限制</td>
<td>内存</td>
<td>QPS</td>
<td>RT</td>
</tr>
<tr>
<td>gfs</td>
<td>2G</td>
<td>4960.12</td>
<td>248.01</td>
</tr>
<tr>
<td>cephfs</td>
<td>2G</td>
<td>18466.87</td>
<td>923.33</td>
</tr>
<tr>
<td>ceph-block</td>
<td>2G</td>
<td>24313.80</td>
<td>1215.68</td>
</tr>
</tbody></table>
<h4 id="数据库只读性能测试-1"><a href="#数据库只读性能测试-1" class="headerlink" title="数据库只读性能测试"></a>数据库只读性能测试</h4><table>
<thead>
<tr>
<th>正常rainbond创建组件测试</th>
<th>内存</th>
<th>QPS</th>
<th>RT</th>
</tr>
</thead>
<tbody><tr>
<td>gfs</td>
<td>2G</td>
<td>1955.06</td>
<td>139.65</td>
</tr>
<tr>
<td>cephfs</td>
<td>2G</td>
<td>1485.79</td>
<td>106.13</td>
</tr>
<tr>
<td>ceph-block</td>
<td>2G</td>
<td>1663.10</td>
<td>118.79</td>
</tr>
<tr>
<td>消除rainbond组件环境限制</td>
<td>内存</td>
<td>QPS</td>
<td>RT</td>
</tr>
<tr>
<td>gfs</td>
<td>2G</td>
<td>28345.14</td>
<td>2024.65</td>
</tr>
<tr>
<td>cephfs</td>
<td>2G</td>
<td>46298.51</td>
<td>3307.04</td>
</tr>
<tr>
<td>ceph-block</td>
<td>2G</td>
<td>47795.73</td>
<td>3413.98</td>
</tr>
</tbody></table>
<h4 id="数据库只写性能测试-1"><a href="#数据库只写性能测试-1" class="headerlink" title="数据库只写性能测试"></a>数据库只写性能测试</h4><table>
<thead>
<tr>
<th>正常rainbond创建组件测试</th>
<th>内存</th>
<th>TPS</th>
<th>RT</th>
</tr>
</thead>
<tbody><tr>
<td>gfs</td>
<td>2G</td>
<td>1757.65</td>
<td>292.85</td>
</tr>
<tr>
<td>cephfs</td>
<td>2G</td>
<td>1651.41</td>
<td>275.11</td>
</tr>
<tr>
<td>ceph-block</td>
<td>2G</td>
<td>1489.15</td>
<td>248.05</td>
</tr>
<tr>
<td>消除rainbond组件环境限制</td>
<td>内存</td>
<td>TPS</td>
<td>RT</td>
</tr>
<tr>
<td>gfs</td>
<td>2G</td>
<td>3733.67</td>
<td>622.28</td>
</tr>
<tr>
<td>cephfs</td>
<td>2G</td>
<td>10107.03</td>
<td>1684.47</td>
</tr>
<tr>
<td>ceph-block</td>
<td>2G</td>
<td>15936.48</td>
<td>2656.03</td>
</tr>
</tbody></table>
<h2 id="分配4G内存测试"><a href="#分配4G内存测试" class="headerlink" title="分配4G内存测试"></a>分配4G内存测试</h2><h4 id="数据库读写性能测试-2"><a href="#数据库读写性能测试-2" class="headerlink" title="数据库读写性能测试"></a>数据库读写性能测试</h4><table>
<thead>
<tr>
<th>正常rainbond创建组件测试</th>
<th>内存</th>
<th>QPS</th>
<th>RT</th>
</tr>
</thead>
<tbody><tr>
<td>gfs</td>
<td>4G</td>
<td>1774.29</td>
<td>88.63</td>
</tr>
<tr>
<td>cephfs</td>
<td>4G</td>
<td>1470.74</td>
<td>73.45</td>
</tr>
<tr>
<td>ceph-block</td>
<td>4G</td>
<td>1653.10</td>
<td>82.62</td>
</tr>
<tr>
<td>消除rainbond组件环境限制</td>
<td>内存</td>
<td>QPS</td>
<td>RT</td>
</tr>
<tr>
<td>gfs</td>
<td>4G</td>
<td>5256.70</td>
<td>262.84</td>
</tr>
<tr>
<td>cephfs</td>
<td>4G</td>
<td>18408.52</td>
<td>920.41</td>
</tr>
<tr>
<td>ceph-block</td>
<td>4G</td>
<td>24333.92</td>
<td>1216.68</td>
</tr>
</tbody></table>
<h4 id="数据库只读性能测试-2"><a href="#数据库只读性能测试-2" class="headerlink" title="数据库只读性能测试"></a>数据库只读性能测试</h4><table>
<thead>
<tr>
<th>正常rainbond创建组件测试</th>
<th>内存</th>
<th>QPS</th>
<th>RT</th>
</tr>
</thead>
<tbody><tr>
<td>gfs</td>
<td>4G</td>
<td>1964.25</td>
<td>140.30</td>
</tr>
<tr>
<td>cephfs</td>
<td>4G</td>
<td>1496.51</td>
<td>106.89</td>
</tr>
<tr>
<td>ceph-block</td>
<td>4G</td>
<td>1611.50</td>
<td>115.11</td>
</tr>
<tr>
<td>消除rainbond组件环境限制</td>
<td>内存</td>
<td>QPS</td>
<td>RT</td>
</tr>
<tr>
<td>gfs</td>
<td>4G</td>
<td>28524.40</td>
<td>2037.46</td>
</tr>
<tr>
<td>cephfs</td>
<td>4G</td>
<td>46614.81</td>
<td>3329.63</td>
</tr>
<tr>
<td>ceph-block</td>
<td>4G</td>
<td>47167.30</td>
<td>3369.09</td>
</tr>
</tbody></table>
<h4 id="数据库只写性能测试-2"><a href="#数据库只写性能测试-2" class="headerlink" title="数据库只写性能测试"></a>数据库只写性能测试</h4><table>
<thead>
<tr>
<th>正常rainbond创建组件测试</th>
<th>内存</th>
<th>TPS</th>
<th>RT</th>
</tr>
</thead>
<tbody><tr>
<td>gfs</td>
<td>4G</td>
<td>1624.56</td>
<td>270.64</td>
</tr>
<tr>
<td>cephfs</td>
<td>4G</td>
<td>1489.19</td>
<td>248.09</td>
</tr>
<tr>
<td>ceph-block</td>
<td>4G</td>
<td>1510.36</td>
<td>251.61</td>
</tr>
<tr>
<td>消除rainbond组件环境限制</td>
<td>内存</td>
<td>TPS</td>
<td>RT</td>
</tr>
<tr>
<td>gfs</td>
<td>4G</td>
<td>3765.16</td>
<td>627.53</td>
</tr>
<tr>
<td>cephfs</td>
<td>4G</td>
<td>9993.07</td>
<td>1665.49</td>
</tr>
<tr>
<td>ceph-block</td>
<td>4G</td>
<td>15923.18</td>
<td>2653.80</td>
</tr>
</tbody></table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/06/09/rke2203%E7%89%88%E6%9C%AC%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="丁辉滴小窝">
      <meta itemprop="description" content="记住你要学习，要努力">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记点笔记ye~">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/09/rke2203%E7%89%88%E6%9C%AC%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">rke2203版本安装</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-06-09 10:25:43 / 修改时间：10:26:08" itemprop="dateCreated datePublished" datetime="2022-06-09T10:25:43+08:00">2022-06-09</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>企业版基于Helm的部署文档</p>
<ul>
<li><h2 id="部署-K8s-集群"><a href="#部署-K8s-集群" class="headerlink" title="部署 K8s 集群"></a>部署 K8s 集群</h2><ul>
<li><p>安装 docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装节点执行</span></span><br><span class="line">ssh-keygen</span><br><span class="line"><span class="comment">#下载安装包</span></span><br><span class="line">https://goodrain-delivery.oss-cn-hangzhou.aliyuncs.com/rke   </span><br><span class="line">wget https://rainbond-pkg.oss-cn-shanghai.aliyuncs.com/offline/5.3-enterprise/rainbond-offline-enterprise-2203.tgz</span><br><span class="line"><span class="comment">#所有节点执行</span></span><br><span class="line">tar xvf rainbond-offline-enterprise-2203.tgz &amp;&amp; <span class="built_in">cd</span> offline</span><br><span class="line"><span class="comment"># SSH_RSA的值可以在安装节点通过 cat /root/.ssh/id_rsa.pub 获取（三台都输入管理节点的值）</span></span><br><span class="line"><span class="built_in">export</span> SSH_RSA=<span class="string">&#x27;ssh-rsa （红色字体请替换成主节点的值） AAAAB3NzaC1yc2EAAAADAQABAAABAQCkA4iSDTve4xPy8GMkwC5JI6S/DVKYt5Q2IGL5CX0oeWsTgPnmC743uLIgTrwT6vlaR95Bb31CxsGC//3x/YikEEziPxxopFD24L5sqzw+jG8R8kRhFT9G5OPDgFZwiUrsjUbFl13Vl60OqfZIjGihQOYgQvz2pVfUy/eopdDTbTTNc/clZBV1KoV7pPRdmJfNPS2nHCETT0K34JsE03J231Lpp1NKmK5XTFs+oas8oDR8+zdnwU631GchkEqSlO6NygaY5B7uSpOsLb8FugNtYyZ12qUw94FJZcF7ipPwjEGojXyG9p+eIn+bRAmE0OpagoKqASqn5EPuKjQa2ppv root@node&#x27;</span> &amp;&amp; ./init_node_offline.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装 k8s</p>
<ul>
<li><p>修改 cluster.yaml 文件内容，根据需要添加其它节点</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># If you intended to deploy Kubernetes in an air-gapped environment,</span></span><br><span class="line"><span class="comment"># please consult the documentation on how to configure custom RKE images.</span></span><br><span class="line"><span class="attr">nodes:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">address:</span> <span class="number">192.168</span><span class="number">.2</span><span class="number">.212</span>       <span class="comment">#主节点的IP</span></span><br><span class="line">  <span class="attr">port:</span> <span class="string">&quot;22&quot;</span></span><br><span class="line">  <span class="attr">internal_address:</span> <span class="number">192.168</span><span class="number">.2</span><span class="number">.212</span>    <span class="comment">##主节点的IP</span></span><br><span class="line">  <span class="attr">role:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">controlplane</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">worker</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">etcd</span></span><br><span class="line">  <span class="attr">hostname_override:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">user:</span> <span class="string">docker</span></span><br><span class="line">  <span class="attr">docker_socket:</span> <span class="string">/var/run/docker.sock</span></span><br><span class="line">  <span class="attr">ssh_key:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">ssh_key_path:</span> <span class="string">~/.ssh/id_rsa</span></span><br><span class="line">  <span class="attr">ssh_cert:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">ssh_cert_path:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">labels:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">taints:</span> []</span><br><span class="line"><span class="bullet">-</span> <span class="attr">address:</span> <span class="number">192.168</span><span class="number">.2</span><span class="number">.113</span>     <span class="comment">#从节点的IP</span></span><br><span class="line">  <span class="attr">port:</span> <span class="string">&quot;22&quot;</span></span><br><span class="line">  <span class="attr">internal_address:</span> <span class="number">192.168</span><span class="number">.2</span><span class="number">.113</span>     <span class="comment">#从节点的IP</span></span><br><span class="line">  <span class="attr">role:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">worker</span></span><br><span class="line">  <span class="attr">hostname_override:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">user:</span> <span class="string">docker</span></span><br><span class="line">  <span class="attr">docker_socket:</span> <span class="string">/var/run/docker.sock</span></span><br><span class="line">  <span class="attr">ssh_key:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">ssh_key_path:</span> <span class="string">~/.ssh/id_rsa</span></span><br><span class="line">  <span class="attr">ssh_cert:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">ssh_cert_path:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">labels:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">taints:</span> []</span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">etcd:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">extra_args:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">extra_binds:</span> []</span><br><span class="line">    <span class="attr">extra_env:</span> []</span><br><span class="line">    <span class="attr">win_extra_args:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">win_extra_binds:</span> []</span><br><span class="line">    <span class="attr">win_extra_env:</span> []</span><br><span class="line">    <span class="attr">external_urls:</span> []</span><br><span class="line">    <span class="attr">ca_cert:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">cert:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">key:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">uid:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">gid:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">snapshot:</span> <span class="literal">null</span></span><br><span class="line">    <span class="attr">retention:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">creation:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">backup_config:</span> <span class="literal">null</span></span><br><span class="line">  <span class="attr">kube-api:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">extra_args:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">extra_binds:</span> []</span><br><span class="line">    <span class="attr">extra_env:</span> []</span><br><span class="line">    <span class="attr">win_extra_args:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">win_extra_binds:</span> []</span><br><span class="line">    <span class="attr">win_extra_env:</span> []</span><br><span class="line">    <span class="attr">service_cluster_ip_range:</span> <span class="number">10.43</span><span class="number">.0</span><span class="number">.0</span><span class="string">/16</span></span><br><span class="line">    <span class="attr">service_node_port_range:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">pod_security_policy:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">always_pull_images:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">secrets_encryption_config:</span> <span class="literal">null</span></span><br><span class="line">    <span class="attr">audit_log:</span> <span class="literal">null</span></span><br><span class="line">    <span class="attr">admission_configuration:</span> <span class="literal">null</span></span><br><span class="line">    <span class="attr">event_rate_limit:</span> <span class="literal">null</span></span><br><span class="line">  <span class="attr">kube-controller:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">extra_args:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">extra_binds:</span> []</span><br><span class="line">    <span class="attr">extra_env:</span> []</span><br><span class="line">    <span class="attr">win_extra_args:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">win_extra_binds:</span> []</span><br><span class="line">    <span class="attr">win_extra_env:</span> []</span><br><span class="line">    <span class="attr">cluster_cidr:</span> <span class="number">10.42</span><span class="number">.0</span><span class="number">.0</span><span class="string">/16</span></span><br><span class="line">    <span class="attr">service_cluster_ip_range:</span> <span class="number">10.43</span><span class="number">.0</span><span class="number">.0</span><span class="string">/16</span></span><br><span class="line">  <span class="attr">scheduler:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">extra_args:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">extra_binds:</span> []</span><br><span class="line">    <span class="attr">extra_env:</span> []</span><br><span class="line">    <span class="attr">win_extra_args:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">win_extra_binds:</span> []</span><br><span class="line">    <span class="attr">win_extra_env:</span> []</span><br><span class="line">  <span class="attr">kubelet:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">extra_args:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">extra_binds:</span> []</span><br><span class="line">    <span class="attr">extra_env:</span> []</span><br><span class="line">    <span class="attr">win_extra_args:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">win_extra_binds:</span> []</span><br><span class="line">    <span class="attr">win_extra_env:</span> []</span><br><span class="line">    <span class="attr">cluster_domain:</span> <span class="string">cluster.local</span></span><br><span class="line">    <span class="attr">infra_container_image:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">cluster_dns_server:</span> <span class="number">10.43</span><span class="number">.0</span><span class="number">.10</span></span><br><span class="line">    <span class="attr">fail_swap_on:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">generate_serving_certificate:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">kubeproxy:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">extra_args:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">extra_binds:</span> []</span><br><span class="line">    <span class="attr">extra_env:</span> []</span><br><span class="line">    <span class="attr">win_extra_args:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">win_extra_binds:</span> []</span><br><span class="line">    <span class="attr">win_extra_env:</span> []</span><br><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">plugin:</span> <span class="string">flannel</span></span><br><span class="line">  <span class="attr">options:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">mtu:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">node_selector:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">update_strategy:</span> <span class="literal">null</span></span><br><span class="line">  <span class="attr">tolerations:</span> []</span><br><span class="line"><span class="attr">authentication:</span></span><br><span class="line">  <span class="attr">strategy:</span> <span class="string">x509</span></span><br><span class="line">  <span class="attr">sans:</span> []</span><br><span class="line">  <span class="attr">webhook:</span> <span class="literal">null</span></span><br><span class="line"><span class="attr">addons:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">addons_include:</span> []</span><br><span class="line"><span class="attr">system_images:</span></span><br><span class="line">  <span class="attr">etcd:</span> <span class="string">goodrain.me/coreos-etcd:v3.4.13-rke</span></span><br><span class="line">  <span class="attr">alpine:</span> <span class="string">goodrain.me/rke-tools:v0.1.68</span></span><br><span class="line">  <span class="attr">nginx_proxy:</span> <span class="string">goodrain.me/rke-tools:v0.1.68</span></span><br><span class="line">  <span class="attr">cert_downloader:</span> <span class="string">goodrain.me/rke-tools:v0.1.68</span></span><br><span class="line">  <span class="attr">kubernetes_services_sidecar:</span> <span class="string">goodrain.me/rke-tools:v0.1.68</span></span><br><span class="line">  <span class="attr">kubedns:</span> <span class="string">goodrain.me/k8s-dns-kube-dns:1.15.10</span></span><br><span class="line">  <span class="attr">dnsmasq:</span> <span class="string">goodrain.me/k8s-dns-dnsmasq-nanny:1.15.10</span></span><br><span class="line">  <span class="attr">kubedns_sidecar:</span> <span class="string">goodrain.me/k8s-dns-sidecar:1.15.10</span></span><br><span class="line">  <span class="attr">kubedns_autoscaler:</span> <span class="string">goodrain.me/cluster-proportional-autoscaler:1.8.1</span></span><br><span class="line">  <span class="attr">coredns:</span> <span class="string">goodrain.me/coredns-coredns:1.7.0</span></span><br><span class="line">  <span class="attr">coredns_autoscaler:</span> <span class="string">goodrain.me/cluster-proportional-autoscaler:1.8.1</span></span><br><span class="line">  <span class="attr">nodelocal:</span> <span class="string">goodrain.me/k8s-dns-node-cache:1.15.13</span></span><br><span class="line">  <span class="attr">kubernetes:</span> <span class="string">goodrain.me/hyperkube:v1.19.6-rke</span></span><br><span class="line">  <span class="attr">flannel:</span> <span class="string">goodrain.me/coreos-flannel:v0.13.0-rke</span></span><br><span class="line">  <span class="attr">flannel_cni:</span> <span class="string">goodrain.me/flannel-cni:v0.3.0-rke</span></span><br><span class="line">  <span class="attr">calico_node:</span> <span class="string">goodrain.me/calico-node:v3.16.5</span></span><br><span class="line">  <span class="attr">calico_cni:</span> <span class="string">goodrain.me/calico-cni:v3.16.5</span></span><br><span class="line">  <span class="attr">calico_controllers:</span> <span class="string">goodrain.me/calico-kube-controllers:v3.16.5</span></span><br><span class="line">  <span class="attr">calico_ctl:</span> <span class="string">goodrain.me/calico-ctl:v3.16.5</span></span><br><span class="line">  <span class="attr">calico_flexvol:</span> <span class="string">goodrain.me/calico-pod2daemon-flexvol:v3.16.5</span></span><br><span class="line">  <span class="attr">canal_node:</span> <span class="string">goodrain.me/calico-node:v3.16.5</span></span><br><span class="line">  <span class="attr">canal_cni:</span> <span class="string">goodrain.me/calico-cni:v3.16.5</span></span><br><span class="line">  <span class="attr">canal_controllers:</span> <span class="string">goodrain.me/calico-kube-controllers:v3.16.5</span></span><br><span class="line">  <span class="attr">canal_flannel:</span> <span class="string">goodrain.me/coreos-flannel:v0.13.0-rancher1</span></span><br><span class="line">  <span class="attr">canal_flexvol:</span> <span class="string">goodrain.me/calico-pod2daemon-flexvol:v3.16.5</span></span><br><span class="line">  <span class="attr">weave_node:</span> <span class="string">weaveworks/weave-kube:2.7.0</span></span><br><span class="line">  <span class="attr">weave_cni:</span> <span class="string">weaveworks/weave-npc:2.7.0</span></span><br><span class="line">  <span class="attr">pod_infra_container:</span> <span class="string">goodrain.me/pause:3.2</span></span><br><span class="line">  <span class="attr">ingress:</span> <span class="string">goodrain.me/nginx-ingress-controller:nginx-0.35.0-rancher2</span></span><br><span class="line">  <span class="attr">ingress_backend:</span> <span class="string">goodrain.me/nginx-ingress-controller-defaultbackend:1.5-rancher1</span></span><br><span class="line">  <span class="attr">metrics_server:</span> <span class="string">goodrain.me/metrics-server:v0.3.6</span></span><br><span class="line">  <span class="attr">windows_pod_infra_container:</span> <span class="string">goodrain.me/kubelet-pause:v0.1.4</span></span><br><span class="line">  <span class="attr">aci_cni_deploy_container:</span> <span class="string">noiro/cnideploy:5.1.1.0.1ae238a</span></span><br><span class="line">  <span class="attr">aci_host_container:</span> <span class="string">noiro/aci-containers-host:5.1.1.0.1ae238a</span></span><br><span class="line">  <span class="attr">aci_opflex_container:</span> <span class="string">noiro/opflex:5.1.1.0.1ae238a</span></span><br><span class="line">  <span class="attr">aci_mcast_container:</span> <span class="string">noiro/opflex:5.1.1.0.1ae238a</span></span><br><span class="line">  <span class="attr">aci_ovs_container:</span> <span class="string">noiro/openvswitch:5.1.1.0.1ae238a</span></span><br><span class="line">  <span class="attr">aci_controller_container:</span> <span class="string">noiro/aci-containers-controller:5.1.1.0.1ae238a</span></span><br><span class="line">  <span class="attr">aci_gbp_server_container:</span> <span class="string">noiro/gbp-server:5.1.1.0.1ae238a</span></span><br><span class="line">  <span class="attr">aci_opflex_server_container:</span> <span class="string">noiro/opflex-server:5.1.1.0.1ae238a</span></span><br><span class="line"><span class="attr">ssh_key_path:</span> <span class="string">~/.ssh/id_rsa</span></span><br><span class="line"><span class="attr">ssh_cert_path:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">ssh_agent_auth:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">authorization:</span></span><br><span class="line">  <span class="attr">mode:</span> <span class="string">rbac</span></span><br><span class="line">  <span class="attr">options:</span> &#123;&#125;</span><br><span class="line"><span class="attr">ignore_docker_version:</span> <span class="literal">null</span></span><br><span class="line"><span class="attr">kubernetes_version:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">private_registries:</span> []</span><br><span class="line"><span class="attr">ingress:</span></span><br><span class="line">  <span class="attr">provider:</span> <span class="string">&quot;none&quot;</span></span><br><span class="line">  <span class="attr">options:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">node_selector:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">extra_args:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">dns_policy:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">extra_envs:</span> []</span><br><span class="line">  <span class="attr">extra_volumes:</span> []</span><br><span class="line">  <span class="attr">extra_volume_mounts:</span> []</span><br><span class="line">  <span class="attr">update_strategy:</span> <span class="literal">null</span></span><br><span class="line">  <span class="attr">http_port:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">https_port:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">network_mode:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">tolerations:</span> []</span><br><span class="line">  <span class="attr">default_backend:</span> <span class="literal">null</span></span><br><span class="line"><span class="attr">cluster_name:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">cloud_provider:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">prefix_path:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">win_prefix_path:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">addon_job_timeout:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">bastion_host:</span></span><br><span class="line">  <span class="attr">address:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">port:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">user:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">ssh_key:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">ssh_key_path:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">ssh_cert:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">ssh_cert_path:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">monitoring:</span></span><br><span class="line">  <span class="attr">provider:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">options:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">node_selector:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">update_strategy:</span> <span class="literal">null</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="literal">null</span></span><br><span class="line">  <span class="attr">tolerations:</span> []</span><br><span class="line"><span class="attr">restore:</span></span><br><span class="line">  <span class="attr">restore:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">snapshot_name:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">rotate_encryption_key:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">dns:</span> <span class="literal">null</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>执行安装操作</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">./rke up</span><br><span class="line"><span class="comment">#执行成功后使用不了kubectl命令，所以需要创建目录，并拷贝配置文件</span></span><br><span class="line"><span class="built_in">mkdir</span> /root/.kube &amp;&amp; <span class="built_in">cp</span> kube_config_cluster.yml /root/.kube/config</span><br><span class="line"><span class="comment">#启动后metrics-server会获取不到镜像，修改镜像拉取策略为 IfNotPresent</span></span><br><span class="line">kubectl edit deploy -n kube-system metrics-server</span><br></pre></td></tr></table></figure>
</li>
<li><p>确认安装结果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get node</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><h2 id="部署Mysql主从集群"><a href="#部署Mysql主从集群" class="headerlink" title="部署Mysql主从集群"></a>部署Mysql主从集群</h2><p>在主从服务器中执行以下命令获取镜像：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql</span><br></pre></td></tr></table></figure>

<p>容器启动时需要分别挂载主从数据库的配置文件</p>
<p>主数据库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">$ vi /var/lib/mysql/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">pid-file        = /var/run/mysqld/mysqld.pid</span><br><span class="line">socket          = /var/run/mysqld/mysqld.sock</span><br><span class="line">datadir         = /var/lib/mysql</span><br><span class="line">secure-file-priv= NULL</span><br><span class="line"><span class="comment"># Disabling symbolic-links is recommended to prevent assorted security risks</span></span><br><span class="line">symbolic-links=0</span><br><span class="line"><span class="comment"># 服务端默认utf8编码</span></span><br><span class="line">character-set-server=utf8mb4</span><br><span class="line"><span class="comment"># 默认存储引擎</span></span><br><span class="line">default-storage-engine=INNODB</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主从配置</span></span><br><span class="line">log-bin=binlog</span><br><span class="line">server-id=121</span><br><span class="line">gtid-mode=on</span><br><span class="line">enforce-gtid-consistency=on</span><br><span class="line">log-slave-updates=on</span><br><span class="line">expire_logs_days=14</span><br><span class="line"></span><br><span class="line"><span class="comment"># Compatible with versions before 8.0</span></span><br><span class="line">default_authentication_plugin=mysql_native_password</span><br><span class="line">skip-host-cache</span><br><span class="line">skip-name-resolve</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line"><span class="comment">#设置客户端编码</span></span><br><span class="line">default-character-set=utf8mb4</span><br><span class="line">[mysql]</span><br><span class="line"><span class="comment"># 设置mysql客户端默认编码</span></span><br><span class="line">default-character-set=utf8mb4</span><br><span class="line"></span><br><span class="line"><span class="comment"># Custom config should go here</span></span><br><span class="line">!includedir /etc/mysql/conf.d/</span><br><span class="line"><span class="comment"># Custom config should go here</span></span><br><span class="line">!includedir /etc/mysql/conf.d/</span><br></pre></td></tr></table></figure>

<p>从数据库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">$ vi /var/lib/mysql/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">pid-file        = /var/run/mysqld/mysqld.pid</span><br><span class="line">socket          = /var/run/mysqld/mysqld.sock</span><br><span class="line">datadir         = /var/lib/mysql</span><br><span class="line">secure-file-priv= NULL</span><br><span class="line"><span class="comment"># Disabling symbolic-links is recommended to prevent assorted security risks</span></span><br><span class="line">symbolic-links=0</span><br><span class="line"><span class="comment"># 服务端默认utf8编码</span></span><br><span class="line">character-set-server=utf8mb4</span><br><span class="line"><span class="comment"># 默认存储引擎</span></span><br><span class="line">default-storage-engine=INNODB</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主从配置</span></span><br><span class="line">server-id=122</span><br><span class="line">gtid-mode=on</span><br><span class="line">enforce-gtid-consistency=on</span><br><span class="line">log-slave-updates=on</span><br><span class="line">expire_logs_days=14</span><br><span class="line"></span><br><span class="line"><span class="comment"># Compatible with versions before 8.0</span></span><br><span class="line">default_authentication_plugin=mysql_native_password</span><br><span class="line">skip-host-cache</span><br><span class="line">skip-name-resolve</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line"><span class="comment">#设置客户端编码</span></span><br><span class="line">default-character-set=utf8mb4</span><br><span class="line">[mysql]</span><br><span class="line"><span class="comment"># 设置mysql客户端默认编码</span></span><br><span class="line">default-character-set=utf8mb4</span><br><span class="line"></span><br><span class="line"><span class="comment"># Custom config should go here</span></span><br><span class="line">!includedir /etc/mysql/conf.d/</span><br><span class="line"><span class="comment"># Custom config should go here</span></span><br><span class="line">!includedir /etc/mysql/conf.d/</span><br></pre></td></tr></table></figure>

<p>启动数据库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql_master --restart=always \</span><br><span class="line">-p 3306:3306 \</span><br><span class="line">-v /var/lib/mysql/my.cnf:/etc/mysql/my.cnf \</span><br><span class="line">-v /var/lib/mysql/data:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=eed1eu.s0S \</span><br><span class="line">-d mysql</span><br></pre></td></tr></table></figure>

<p>查看数据库字符编码,并创建用户授权</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 进入数据库</span><br><span class="line">docker exec -it mysql_master bash</span><br><span class="line"># 创建用户授权</span><br><span class="line">mysql&gt;  CREATE USER &#x27;slave&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;slave&#x27;;</span><br><span class="line">mysql&gt;  GRANT REPLICATION SLAVE ON *.* TO &#x27;slave&#x27;@&#x27;%&#x27;;</span><br><span class="line">mysql&gt;  flush privileges;</span><br></pre></td></tr></table></figure>

<p>获取主节点当前binary log文件名和位置（position）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;  SHOW MASTER STATUS;</span><br><span class="line">+---------------+----------+--------------+------------------+------------------------------------------+</span><br><span class="line">| File          | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set                        |</span><br><span class="line">+---------------+----------+--------------+------------------+------------------------------------------+</span><br><span class="line">| binlog.000003 |      868 |              |                  | 1b009ef8-a67f-11ea-8c9a-0242ac110002:1-8 |</span><br><span class="line">+---------------+----------+--------------+------------------+------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>启动数据库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql_slave --restart=always \</span><br><span class="line">-p 3306:3306 \</span><br><span class="line">-v /var/lib/mysql/my.cnf:/etc/mysql/my.cnf \</span><br><span class="line">-v /var/lib/mysql/data:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=eed1eu.s0S \</span><br><span class="line">-d mysql</span><br></pre></td></tr></table></figure>

<p>配置主从复制</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 进入数据库</span><br><span class="line">docker exec -it mysql_slave bash</span><br><span class="line"># 主从配置</span><br><span class="line">mysql&gt;  CHANGE MASTER TO</span><br><span class="line">mysql&gt;  MASTER_HOST=&#x27;192.168.0.162&#x27;,</span><br><span class="line">mysql&gt;  MASTER_USER=&#x27;slave&#x27;,</span><br><span class="line">mysql&gt;  MASTER_PASSWORD=&#x27;slave&#x27;,</span><br><span class="line">mysql&gt;  MASTER_PORT=3306,</span><br><span class="line">mysql&gt;  MASTER_LOG_FILE=&#x27;binlog.000003&#x27;,</span><br><span class="line">mysql&gt;  MASTER_LOG_POS=868;</span><br><span class="line"></span><br><span class="line"># 开启主从同步</span><br><span class="line">mysql&gt;  start slave;</span><br><span class="line"># 再查看主从同步状态</span><br><span class="line">mysql&gt;  show slave status;</span><br></pre></td></tr></table></figure>

<p>这里只要看到两个参数Slave_IO_Running和Slave_SQL_Running都为true且Error字段都为空则代码主从正常复制</p>
<p>在主服务器创建Rainbond部署所需的数据库，查看从服务器是否同步更新了数据</p>
<p>在主库创建库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;  create database console;</span><br><span class="line">mysql&gt;  create database region;</span><br></pre></td></tr></table></figure>

<p>在从库查看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;  show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| console            |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| region             |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>数据同步成功，则主从复制部署完成</p>
<p>在主库创建用户并授权，为Rainbond后续部署做准备</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;  CREATE USER rainbond;</span><br><span class="line">mysql&gt;  ALTER USER &#x27;rainbond&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;Gz1ea3.G&#x27;;</span><br><span class="line">mysql&gt;  GRANT ALL PRIVILEGES ON *.* TO &#x27;rainbond&#x27;@&#x27;%&#x27;;</span><br></pre></td></tr></table></figure>

<p>从节点配置备份任务</p>
<p>编写备份脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$  <span class="built_in">mkdir</span> -p /var/lib/mysql/backup</span><br><span class="line">$  vi /var/lib/mysql/backup/mysql-backup.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">DATE=`<span class="built_in">date</span> +%Y%m%d%H%M`</span><br><span class="line">DB_USER=rainbond  <span class="comment">#数据库用户名</span></span><br><span class="line">DB_PASS=<span class="string">&quot;Gz1ea3.G&quot;</span>     <span class="comment">#数据库密码</span></span><br><span class="line">BACKUP=/var/lib/mysql/backup/   <span class="comment">#备份文件存储路径</span></span><br><span class="line">      </span><br><span class="line"><span class="comment">#备份</span></span><br><span class="line"></span><br><span class="line">/usr/bin/mysqldump -u<span class="variable">$DB_USER</span> -p<span class="variable">$DB_PASS</span> -h 127.0.0.1 |gzip &gt; <span class="variable">$&#123;BACKUP&#125;</span>\/rainbond_<span class="variable">$&#123;DATE&#125;</span>.sql.gz</span><br><span class="line">      </span><br><span class="line"><span class="comment">#保留最近30天的备份文件</span></span><br><span class="line"></span><br><span class="line">find <span class="variable">$&#123;BACKUP&#125;</span> -name <span class="string">&quot;rainbond_*.sql.gz&quot;</span> -<span class="built_in">type</span> f -mtime +30 -<span class="built_in">exec</span> <span class="built_in">rm</span> &#123;&#125; \; &gt; /dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p>配置计划任务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ crontab -e</span><br><span class="line">0 3 * * * /var/lib/mysql/backup/mysql-backup.sh</span><br></pre></td></tr></table></figure>

<p>赋予执行权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x /var/lib/mysql/backup/mysql-backup.sh</span><br></pre></td></tr></table></figure>
</li>
<li><h2 id="部署gfs集群"><a href="#部署gfs集群" class="headerlink" title="部署gfs集群"></a>部署gfs集群</h2><p>通过 Kubernetes 安装 Glusterfs 集群</p>
<ul>
<li><p>安装好的 Kubernetes 集群，其中三个节点应各挂载一块空间不小于 500G 的 SSD 磁盘</p>
</li>
<li><p>将准备好的磁盘格式化并挂载到指定目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看可用磁盘</span></span><br><span class="line">fdisk -l</span><br><span class="line"><span class="comment"># 分区并格式化</span></span><br><span class="line">mkfs.xfs  /dev/vdb1</span><br><span class="line"><span class="built_in">mkdir</span>  -p /data</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/dev/vdb1  /data  xfs  defaults 1 2&quot;</span> &gt;&gt;/etc/fstab</span><br><span class="line"><span class="comment"># 挂载</span></span><br><span class="line">mount -a</span><br><span class="line"><span class="comment"># 确定/data挂载</span></span><br><span class="line"><span class="built_in">df</span> -h | grep data</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 Kubernetes 所有节点安装对应版本的 Glusterfs 客户端工具并加载所需内核模块</p>
<ul>
<li>Ubuntu 1604&#x2F;1804</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apt install software-properties-common</span><br><span class="line">add-apt-repository ppa:gluster/glusterfs-7</span><br><span class="line">apt update</span><br><span class="line">apt install glusterfs-client -y</span><br><span class="line">modprobe dm_thin_pool</span><br></pre></td></tr></table></figure>

<ul>
<li>CentOS 7</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install centos-release-gluster</span><br><span class="line">yum -y install glusterfs-client</span><br><span class="line">modprobe dm_thin_pool</span><br></pre></td></tr></table></figure></li>
</ul>
<p>部署 Glusterfs 集群</p>
<p>以下操作在 Kubernetes 的任一 master 节点执行一次即可</p>
<ul>
<li><p>获取对应的项目</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://gitee.com/liu_shuai2573/gfs-k8s.git &amp;&amp; <span class="built_in">cd</span> gfs-k8s</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置节点标签，指定对应节点运行 Glusterfs 组件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设置标签，将 Glusterfs1/2/3 更改为对应的 Kubernetes node 节点</span></span><br><span class="line">kubectl label node Glusterfs1 Glusterfs2 Glusterfs3 storagenode=glusterfs</span><br><span class="line"><span class="comment">#执行此操作后，对应节点将只运行 Glusterfs 服务，如需复用该节点，请不要执行此操作</span></span><br><span class="line">kubectl taint node Glusterfs1 Glusterfs2 Glusterfs3 glusterfs=<span class="literal">true</span>:NoSchedule</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建 Glusterfs 服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f gluster-daemonset.yaml</span><br></pre></td></tr></table></figure>
</li>
<li><p>检查 Glusterfs 服务是否在指定节点正常运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods -o wide --selector=glusterfs-node=daemonset</span><br><span class="line">NAME              READY   STATUS    RESTARTS   AGE    IP              NODE            NOMINATED NODE   READINESS GATES</span><br><span class="line">glusterfs-2k5rm   1/1     Running   0          52m    192.168.2.200   192.168.2.200   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">glusterfs-mc6pg   1/1     Running   0          134m   192.168.2.22    192.168.2.22    &lt;none&gt;           &lt;none&gt;</span><br><span class="line">glusterfs-tgsn7   1/1     Running   0          134m   192.168.2.224   192.168.2.224   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>将 Glusterfs 服务添加为统一集群</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#通过其中一个 Glusterfs 服务将其他两个 Glusterfs 服务加入集群</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -ti glusterfs-2k5rm gluster peer probe Glusterfs2_IP</span><br><span class="line">kubectl <span class="built_in">exec</span> -ti glusterfs-2k5rm gluster peer probe Glusterfs3_IP</span><br><span class="line"><span class="comment">#检测是否添加成功，添加成功会显示其他两个 Glusterfs 服务的状态</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -ti glusterfs-2k5rm gluster peer status</span><br></pre></td></tr></table></figure></li>
</ul>
<p>配置 Glusterfs 集群为 Kubernetes 的可使用资源</p>
<ul>
<li><p>创建服务账户并进行 RBAC 授权</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f rbac.yaml</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建 Glusterfs-provisioner</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f deployment.yaml</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建storageclass资源</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改 storageclass.yaml 中的 parameters.brickrootPaths 的值，替换为 Glusterfs 节点的IP</span></span><br><span class="line">kubectl create -f storageclass.yaml</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建 pvc 验证</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f pvc.yaml</span><br><span class="line">kubectl get pvc | grep gluster-simple-claim <span class="comment">#创建成功时STATUS为Bound</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建 pod 验证</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f pod.yaml</span><br><span class="line">kubectl get po | grep gluster-simple-pod <span class="comment">#运行正常时STATUS为Running</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>移除验证 pod</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete -f pod.yaml</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><h2 id="CentOS-Keepalived配置"><a href="#CentOS-Keepalived配置" class="headerlink" title="CentOS Keepalived配置"></a>CentOS Keepalived配置</h2><p>借助 <strong>Keepalived</strong> 完成VIP配置</p>
<ul>
<li>在网关节点安装 Keepalived</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum install -y keepalived</span><br></pre></td></tr></table></figure>

<ul>
<li><p>编辑配置文件</p>
<p>注意！当前调用健康监测脚本内容为注释状态，原因是在安装 Rainbond 前 需要确保 VIP 已经存在；在 Rainbond 安装完成之后需将注释取消，才能实现健康监测，确保 网关高可用。</p>
<ul>
<li>主节点</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">$ vi /etc/keepalived/keepalived.conf</span><br><span class="line"></span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   router_id LVS_DEVEL</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#vrrp_script check_gateway &#123;</span></span><br><span class="line"><span class="comment"># 检测脚本</span></span><br><span class="line"><span class="comment">#   script &quot;/etc/keepalived/check_gateway_status.sh&quot;</span></span><br><span class="line"><span class="comment"># 执行间隔时间</span></span><br><span class="line"><span class="comment">#   interval 5</span></span><br><span class="line"><span class="comment">#&#125;</span></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">                    </span><br><span class="line">    <span class="comment">#因使用非抢占模式，这里都为backup</span></span><br><span class="line">    state BACKUP </span><br><span class="line">    <span class="comment">#网卡设备名，通过 ifconfig 命令确定  </span></span><br><span class="line">    interface ens6f0     <span class="comment">#网卡名称  </span></span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    <span class="comment">#优先级，主节点大于备节点     </span></span><br><span class="line">    priority 100    </span><br><span class="line">    advert_int 1</span><br><span class="line">    <span class="comment">#非抢占模式</span></span><br><span class="line">    nopreempt</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        &lt;VIP&gt;               </span><br><span class="line">     &#125;</span><br><span class="line"><span class="comment">#     track_script &#123;</span></span><br><span class="line"><span class="comment">#    check_gateway</span></span><br><span class="line"><span class="comment">#   &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>从节点</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">$ vi /etc/keepalived/keepalived.conf</span><br><span class="line"></span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   router_id LVS_DEVEL</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#vrrp_script check_gateway &#123;</span></span><br><span class="line"><span class="comment"># 检测脚本</span></span><br><span class="line"><span class="comment">#  script &quot;/etc/keepalived/check_gateway_status.sh&quot;</span></span><br><span class="line"><span class="comment"># 执行间隔时间</span></span><br><span class="line"><span class="comment">#  interval 5</span></span><br><span class="line"><span class="comment">#  &#125;    </span></span><br><span class="line">    vrrp_instance VI_1 &#123;</span><br><span class="line">    <span class="comment">#因使用非抢占模式，这里都为backup</span></span><br><span class="line">    state BACKUP </span><br><span class="line">    <span class="comment">#网卡设备名，通过 ifconfig 命令确定   </span></span><br><span class="line">    interface ens6f0  <span class="comment">#网卡名称</span></span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    <span class="comment">#优先级，主节点大于备节点   </span></span><br><span class="line">    priority 50</span><br><span class="line">    advert_int 1</span><br><span class="line">    <span class="comment">#非抢占模式</span></span><br><span class="line">    nopreempt</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        &lt;VIP&gt;           </span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">#     track_script &#123;</span></span><br><span class="line"><span class="comment">#    check_gateway</span></span><br><span class="line"><span class="comment">#   &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>健康监测脚本</p>
<p>扩展对网关节点健康检查的脚本，脚本的功能是当 rbd-gateway 组件停止服务，则关闭本机的 Keepalived，切换 VIP 。(主从都需操作)</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ vi /etc/keepalived/check_gateway_status.sh </span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash                                                                                             </span></span><br><span class="line">/usr/bin/curl -I http://localhost:10254/healthz </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ];<span class="keyword">then</span></span><br><span class="line">                                                                   </span><br><span class="line">     <span class="built_in">cat</span> /var/run/keepalived.pid | xargs <span class="built_in">kill</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>添加执行权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">chmod</span> +x /etc/keepalived/check_gateway_status.sh</span><br></pre></td></tr></table></figure>

<ul>
<li><p>更改 Keepalived systemd 配置文件，添加两项配置</p>
<p>添加两项参数</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$  vi /lib/systemd/system/keepalived.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># /lib/systemd/system/keepalived.service</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Keepalive Daemon (LVS and VRRP)</span><br><span class="line">After=network-online.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line"><span class="comment"># Only start if there is a configuration file</span></span><br><span class="line">ConditionFileNotEmpty=/etc/keepalived/keepalived.conf</span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">KillMode=process</span><br><span class="line">PIDFile=/var/run/keepalived.pid</span><br><span class="line"><span class="comment"># Read configuration variable file if it is present</span></span><br><span class="line">EnvironmentFile=-/etc/default/keepalived</span><br><span class="line">ExecStart=/usr/sbin/keepalived <span class="variable">$DAEMON_ARGS</span></span><br><span class="line">ExecReload=/bin/kill -HUP <span class="variable">$MAINPID</span></span><br><span class="line"><span class="comment"># 总是重启该服务</span></span><br><span class="line">Restart=always</span><br><span class="line"><span class="comment"># 重启间隔时间</span></span><br><span class="line">RestartSec=10</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<ul>
<li><p>启动服务</p>
<p>启动服务并设置开机自启动</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl start keepalived</span><br><span class="line">systemctl <span class="built_in">enable</span> keepalived</span><br><span class="line">systemctl status keepalived</span><br></pre></td></tr></table></figure>

<ul>
<li>检测 VIP 是否启动</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip a |grep &lt;VIP&gt;</span><br></pre></td></tr></table></figure>

<p>在 Rainbond 安装完成之后请将配置文件中注释取消并重启 Keepalived 服务，实现健康监测，以此确保 网关高可用。</p>
<p>#ubuntu可以参考此文档<a target="_blank" rel="noopener" href="https://www.rainbond.com/docs/user-operations/Install-extension/ubuntu_keepalived">https://www.rainbond.com/docs/user-operations/Install-extension/ubuntu_keepalived</a></p>
</li>
<li><h2 id="部署Rainbond集群"><a href="#部署Rainbond集群" class="headerlink" title="部署Rainbond集群"></a>部署Rainbond集群</h2><ul>
<li><p>生成所需的 secret 资源</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">kubectl create ns rbd-system</span><br><span class="line"></span><br><span class="line">kubectl create secret generic rbd-etcd-secret -n rbd-system \</span><br><span class="line">--from-file=ca-file=/etc/kubernetes/ssl/kube-ca.pem \</span><br><span class="line">--from-file=cert-file=/etc/kubernetes/ssl/kube-node.pem \</span><br><span class="line">--from-file=key-file=/etc/kubernetes/ssl/kube-node-key.pem</span><br><span class="line"><span class="comment">#根据实际情况修改license-file的内容</span></span><br><span class="line">kubectl create secret generic rbd-console-license -n rbd-system --from-file=license-file=./test2203-goodrain-CONSOLE-LICENSE.yb</span><br><span class="line"></span><br><span class="line">kubectl create secret generic rbd-api-license -n rbd-system --from-file=license-file=./test2203-goodrain-LICENSE.yb</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改 value.yml 文件内容</p>
<p>根据实际情况修改配置内容，配置项说明参考 <a target="_blank" rel="noopener" href="https://www.rainbond.com/docs/user-operations/deploy/install-with-helm/vaules-config">https://www.rainbond.com/docs/user-operations/deploy/install-with-helm/vaules-config</a></p>
</li>
<li><p>安装集群</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/goodrain/rainbond-chart.git</span><br><span class="line">helm install -f value.yml rainbond ./rainbond-chart -n rbd-system</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker run --name=rainbond-allinone --restart=always \</span><br><span class="line">-d -p 7070:7070   \</span><br><span class="line">-v ~/.ssh:/root/.ssh \</span><br><span class="line">-v ~/rainbonddata:/app/data   \</span><br><span class="line">-v ~/license:/opt/license \</span><br><span class="line">-e DISABLE_DEFAULT_APP_MARKET=true \</span><br><span class="line">-e IS_ENTERPRISE_EDITION=true \</span><br><span class="line">-e INSTALL_IMAGE_REPO=goodrain.me \</span><br><span class="line">-e RAINBOND_VERSION=enterprise-2203 \</span><br><span class="line">-e LICENSE_PATH=/opt/license/test2203-goodrain-CONSOLE-LICENSE.yb \</span><br><span class="line">-e LICENSE_KEY=1234567890 \</span><br><span class="line">goodrain.me/rainbond:enterprise-2203-allinone</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">mkdir rancher</span><br><span class="line">cat &gt; rancher/clear.sh &lt;&lt; EOF</span><br><span class="line">df -h|grep kubelet |awk -F % &#x27;&#123;print $2&#125;&#x27;|xargs umount </span><br><span class="line">rm /var/lib/kubelet/* -rf</span><br><span class="line">rm /etc/kubernetes/* -rf</span><br><span class="line">rm /var/lib/rancher/* -rf</span><br><span class="line">rm /var/lib/etcd/* -rf</span><br><span class="line">rm /var/lib/cni/* -rf</span><br><span class="line"></span><br><span class="line">rm -rf /var/run/calico </span><br><span class="line"></span><br><span class="line">iptables -F &amp;&amp; iptables -t nat -F</span><br><span class="line"></span><br><span class="line">ip link del flannel.1</span><br><span class="line"></span><br><span class="line">docker ps -a|awk &#x27;&#123;print $1&#125;&#x27;|xargs docker rm -f</span><br><span class="line">docker volume ls|awk &#x27;&#123;print $2&#125;&#x27;|xargs docker volume rm</span><br><span class="line"></span><br><span class="line">rm -rf /var/etcd/</span><br><span class="line">rm -rf /run/kubernetes/</span><br><span class="line">docker rm -fv $(docker ps -aq)</span><br><span class="line">docker volume rm  $(docker volume ls)</span><br><span class="line">rm -rf /etc/cni</span><br><span class="line">rm -rf /opt/cni</span><br><span class="line"></span><br><span class="line">systemctl restart docker</span><br><span class="line">EOF</span><br><span class="line">sh rancher/clear.sh</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/06/09/euleros%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2%E5%B9%B3%E5%8F%B0%E4%B8%AD%E9%80%94%E9%81%87%E5%88%B0%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="丁辉滴小窝">
      <meta itemprop="description" content="记住你要学习，要努力">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记点笔记ye~">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/09/euleros%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2%E5%B9%B3%E5%8F%B0%E4%B8%AD%E9%80%94%E9%81%87%E5%88%B0%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/" class="post-title-link" itemprop="url">euleros系统部署平台中途遇到问题解决</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-06-09 10:23:34 / 修改时间：10:24:11" itemprop="dateCreated datePublished" datetime="2022-06-09T10:23:34+08:00">2022-06-09</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>噢啦系统大成修炼阵法</p>
<p>首先因为euleros系统默认 &#x2F;etc&#x2F;ssh&#x2F;sshd_config 文件里面访问权限大多数是系统默认关闭的，所以我们需要更改配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#vi /etc/ssh/sshd_config   </span><br><span class="line"></span><br><span class="line">Port 22                         #开放tcp隧道转发和22端口的访问，方便我们后期的远程连接访问</span><br><span class="line">#AddressFamily any</span><br><span class="line">ListenAddress 0.0.0.0</span><br><span class="line">ListenAddress ::</span><br><span class="line"></span><br><span class="line">LoginGraceTime 2m</span><br><span class="line">PermitRootLogin yes</span><br><span class="line">StrictModes yes</span><br><span class="line"></span><br><span class="line">PasswordAuthentication yes</span><br><span class="line"></span><br><span class="line">GSSAPIAuthentication yes</span><br><span class="line"></span><br><span class="line">UsePAM yes</span><br><span class="line"></span><br><span class="line">#AllowAgentForwarding yes</span><br><span class="line">AllowTcpForwarding yes</span><br><span class="line"></span><br><span class="line">TCPKeepAlive yes</span><br><span class="line"></span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line">RSAAuthentication yes</span><br><span class="line">IgnoreRhosts yes</span><br><span class="line"></span><br><span class="line">StrictModes yes</span><br><span class="line">AllowTcpForwarding yes</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#init_node_offline.sh   文件内的（centos|redhat）这种地方需要添加euleros     </span><br><span class="line">vi init_node_offline.sh</span><br><span class="line">/centos搜索 （centos|redhat|euleros） 这样写 按esc 完后n 是跳转下一个目标</span><br></pre></td></tr></table></figure>

<p>docker安装完成后安装k8s（rke方式）</p>
<p>安装k8s的时候首先检查docker是否能免密登录  ssh docker@IP 不能的话逐一排查</p>
<p>首先ssh-cpoy-id docker@IP 假如显示权限不足，则chown docker:docker &#x2F;home&#x2F;docker&#x2F;.ssh 再次拷贝</p>
<p>安装完成之后进入网页访问</p>
<p>如果访问不到就是euleros系统的防火墙没开放端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=7070/tcp --permanent</span><br></pre></td></tr></table></figure>

<p>访问进去之后，注册登录</p>
<p>根据页面创建集群提示再把其他端口开放，完后再开始创建</p>
<p>华为yum源地址：</p>
<p><a target="_blank" rel="noopener" href="https://support.huaweicloud.com/csg_faq/csg_04_1209.html">https://support.huaweicloud.com/csg_faq/csg_04_1209.html</a></p>
<p>内核更换</p>
<p><a target="_blank" rel="noopener" href="https://t.goodrain.com/t/topic/1305">https://t.goodrain.com/t/topic/1305</a></p>
<p>EULER系统初始化</p>
<p>#允许其他用户连接</p>
<p>vi &#x2F;etc&#x2F;ssh&#x2F;sshd_config </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LoginGraceTime 2m</span><br><span class="line">PermitRootLogin yes</span><br><span class="line">StrictModes yes</span><br><span class="line">UsePAM no</span><br></pre></td></tr></table></figure>

<p>#添加yum源</p>
<p>vi &#x2F;etc&#x2F;yum.repos.d&#x2F;EulerOS.repo</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[base]</span><br><span class="line">name=EulerOS-2.0SP8 base</span><br><span class="line">baseurl=http://mirrors.huaweicloud.com/euler/2.8/os/aarch64/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.huaweicloud.com/euler/2.8/os/RPM-GPG-KEY-EulerOS</span><br></pre></td></tr></table></figure>

<p>执行<strong>yum clean all</strong>清除原有yum缓存</p>
<p>执行<strong>yum makecache</strong>生成新的缓存</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/06/09/%E8%BF%90%E7%BB%B4%E6%89%8B%E5%86%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="丁辉滴小窝">
      <meta itemprop="description" content="记住你要学习，要努力">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记点笔记ye~">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/09/%E8%BF%90%E7%BB%B4%E6%89%8B%E5%86%8C/" class="post-title-link" itemprop="url">运维手册</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-06-09 10:18:12 / 修改时间：15:20:11" itemprop="dateCreated datePublished" datetime="2022-06-09T10:18:12+08:00">2022-06-09</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h5 id="删除pod"><a href="#删除pod" class="headerlink" title="删除pod"></a>删除pod</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pod -l name=rbd-gateway -n rbd-system</span><br></pre></td></tr></table></figure>

<h5 id="查看docker服务收集到的日志"><a href="#查看docker服务收集到的日志" class="headerlink" title="查看docker服务收集到的日志"></a>查看docker服务收集到的日志</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">journalctl -fu docker</span><br></pre></td></tr></table></figure>

<h5 id="迁移pod"><a href="#迁移pod" class="headerlink" title="迁移pod"></a>迁移pod</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl get node</span><br><span class="line">$1</span><br><span class="line">kubectl cordon $1    #将节点1设置不不可调度</span><br><span class="line">kubectl drain $1 --delete-local-data --ignore-daemonsets --force  #执行如下命令迁移节点的pod</span><br><span class="line">kubectl uncordon $1  #节点1维护完毕后，可以再将节点1还原成Ready可分配的状态</span><br></pre></td></tr></table></figure>

<p> kubectl drain –ignore-daemonsets –delete-local-data node07-ingress</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/06/08/vscod%E5%B8%B8%E7%94%A8%E8%AE%B0%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="丁辉滴小窝">
      <meta itemprop="description" content="记住你要学习，要努力">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记点笔记ye~">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/08/vscod%E5%B8%B8%E7%94%A8%E8%AE%B0%E5%BD%95/" class="post-title-link" itemprop="url">vscod常用记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-06-08 11:05:20 / 修改时间：11:07:08" itemprop="dateCreated datePublished" datetime="2022-06-08T11:05:20+08:00">2022-06-08</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="vscode-drawio简介"><a href="#vscode-drawio简介" class="headerlink" title="vscode-drawio简介"></a><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=vscode&spm=1001.2101.3001.7020">vscode</a>-drawio简介</h1><p>网络之大，人才百出，在开源背景下，一些功能只有你想不到，没有做不到。</p>
<p>这不，对于写代码的程序员来说，竟然也可以在VSCode IDE里边写代码，边画逻辑流程图了。</p>
<p>安装方式比较简单，在VSCode最左侧的扩展里面搜索“draw”，安装第一个就可以了。</p>
<p>据官方介绍，下个稳定版本中将添加直接编辑.drawio.png文件的功能，使用这个功能可直接编辑和保存.drawio.png文件，这些文件中包含了一个嵌入的Draw.io图，可随时编辑此类文件，且其png部分都会保持最新。</p>
<p>边写边查</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/jiangjiang_1995/article/details/118018333">https://blog.csdn.net/jiangjiang_1995/article/details/118018333</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/06/07/%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="丁辉滴小窝">
      <meta itemprop="description" content="记住你要学习，要努力">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记点笔记ye~">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/07/%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">导入导出问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-06-07 15:17:32 / 修改时间：16:26:16" itemprop="dateCreated datePublished" datetime="2022-06-07T15:17:32+08:00">2022-06-07</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Docker-push-fails-with-“file-integrity-checksum-failed”-seemingly-at-random"><a href="#Docker-push-fails-with-“file-integrity-checksum-failed”-seemingly-at-random" class="headerlink" title="Docker push fails with “file integrity checksum failed” seemingly at random"></a>Docker push fails with “file integrity checksum failed” seemingly at random</h1><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220607162554488.png" alt="image-20220607162554488"></p>
<p>出错的镜像重新构建就可以了（问题是构建失败）</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/06/07/ceph%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="丁辉滴小窝">
      <meta itemprop="description" content="记住你要学习，要努力">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记点笔记ye~">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/07/ceph%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">ceph所遇到的问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-06-07 14:20:21" itemprop="dateCreated datePublished" datetime="2022-06-07T14:20:21+08:00">2022-06-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-06-09 17:45:42" itemprop="dateModified" datetime="2022-06-09T17:45:42+08:00">2022-06-09</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ceph分配资源过小问题</span><br><span class="line">查找</span><br><span class="line">kubectl get sc rook-ceph</span><br><span class="line">kubectl describe   sc rook-cephfs</span><br><span class="line">加入</span><br><span class="line">kubectl edit sc rook-cephfs -n rook-ceph</span><br><span class="line">allowVolumeExpansion: True</span><br><span class="line">命令行</span><br><span class="line">kubectl exec -ti &lt;pod名&gt; -- df -kh |grep var</span><br><span class="line">kubectl patch pvc &lt;pvc名&gt; -p &#x27;&#123;&quot;spec&quot;: &#123;&quot;resources&quot;: &#123;&quot;requests&quot;: &#123;&quot;storage&quot;: &quot;5Gi&quot;&#125;&#125;&#125;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">所有问题排查</span><br><span class="line">https://access.redhat.com/documentation/zh-cn/red_hat_ceph_storage/5/pdf/troubleshooting_guide/red_hat_ceph_storage-5-troubleshooting_guide-zh-cn.pdf</span><br></pre></td></tr></table></figure>

<p>视频：<a target="_blank" rel="noopener" href="https://asciinema.org/a/351920">https://asciinema.org/a/351920</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph遇到pod重启一直显示ContainerCreating</span><br><span class="line">检查ceph集群是否正常</span><br></pre></td></tr></table></figure>

<p><img src="E:\github-ku\Blog\source_posts\picture\d75c38524eeefc831768da71832cfef.png" alt="d75c38524eeefc831768da71832cfef"></p>
<p><img src="E:\github-ku\Blog\source_posts\picture\image-20220608113210518.png" alt="image-20220608113210518"></p>
<p><img src="E:\github-ku\Blog\source_posts\picture\cea37e7459570149f908dd725c9e416.png" alt="cea37e7459570149f908dd725c9e416"></p>
<p><img src="E:\github-ku\Blog\source_posts\picture\b037c2bf67599302d96a6cf745c86ee.png" alt="b037c2bf67599302d96a6cf745c86ee"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount -lf /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-1739b858-93b0-4ac4-b59e-773a84d3ea83/globalmount</span><br></pre></td></tr></table></figure>

<h4 id="恢复排查"><a href="#恢复排查" class="headerlink" title="恢复排查"></a>恢复排查</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">挂载：https://cloud.tencent.com/developer/article/1683695</span><br><span class="line">挂载：https://blog.csdn.net/jycjyc/article/details/123025061?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-0.pc_relevant_antiscanv2&amp;spm=1001.2101.3001.4242.1&amp;utm_relevant_index=3</span><br><span class="line">https://www.qikqiak.com/k8strain/storage/ceph/   k8s训练营</span><br><span class="line">安装：https://www.bookstack.cn/read/huweihuang-linux-notes/tools-ceph-fuse.md</span><br><span class="line">安装：https://blog.51cto.com/u_11970509/2381262#:~:text=%E5%AE%89%E8%A3%85ceph%E5%AE%A2%E6%88%B7%E7%AB%AF%20%E5%9C%A8%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%BB%E6%9C%BA%E4%B8%8A%E6%94%AF%E6%8C%81%E4%BB%A5%E4%B8%8B%E5%91%BD%E4%BB%A4%20wget%20-O%20%2Fetc%2Fyum.repos.d%2Fceph.repo%20https%3A%2F%2Fraw.githubusercontent.com%2Faishangwei%2Fceph-demo%2Fmaster%2Fceph-deploy%2Fceph.repo%20%E4%B8%8B%E8%BD%BDceph.repo%E9%95%9C%E5%83%8F%E6%BA%90%20yum,-s%20--name%20client.rbd%20%2F%2F%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E7%9A%84%E6%95%B4%E4%BD%93%E6%83%85%E5%86%B5%201.%202.%203.%204.</span><br><span class="line">优化:</span><br><span class="line">https://cloud.tencent.com/developer/article/1664654   日志位置</span><br><span class="line">https://www.cnblogs.com/chuanzhang053/p/8710644.html   mysql目录查询</span><br><span class="line">磁盘满了的问题：</span><br><span class="line">https://blog.csdn.net/wanghuiict/article/details/61414122</span><br><span class="line">https://www.51cto.com/article/476346.html</span><br><span class="line">https://storage.it168.com/a2018/0703/3212/000003212605.shtml</span><br><span class="line">https://bean-li.github.io/OSD-FULL/</span><br><span class="line"></span><br><span class="line">打包所有镜像</span><br><span class="line">docker save $(docker images | grep -v REPOSITORY | awk &#x27;BEGIN&#123;OFS=&quot;:&quot;;ORS=&quot; &quot;&#125;&#123;print $1,$2&#125;&#x27;) -o haha.tar</span><br><span class="line"></span><br><span class="line">整理：</span><br><span class="line">yum -y install epel-release</span><br><span class="line">rpm -Uhv http://download.ceph.com/rpm-jewel/el7/noarch/ceph-release-1-1.el7.noarch.rpm</span><br><span class="line">wget -O /etc/yum.repos.d/ceph.repo https://raw.githubusercontent.com/aishangwei/ceph-demo/master/ceph-deploy/ceph.repo</span><br><span class="line">yum install -y ceph</span><br><span class="line">mount | grep ceph  查找</span><br><span class="line">ceph auth list 查找密钥</span><br><span class="line">mount.ceph   IP和路径:/     挂载位置    -o name=admin,secret=密钥</span><br><span class="line"></span><br><span class="line">du -sh *</span><br><span class="line">fallocate -l 1G 文件名</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">排查：</span><br><span class="line">https://www.bookstack.cn/read/ceph-en/288f7dc9097d5262.md</span><br><span class="line">解决办法：https://www.cnblogs.com/st2021/p/14999988.html  （共享存储）</span><br><span class="line">https://docs.ceph.com/en/latest/rados/operations/health-checks/#pool-near-full   查询</span><br><span class="line"></span><br><span class="line">docker system prune -a</span><br><span class="line">脚本：https://blog.csdn.net/wzj_110/article/details/107901012</span><br><span class="line"></span><br><span class="line">http://www.zjjshen.xyz/2021/05/14/%E5%88%A0%E9%99%A4ceph%E6%8C%82%E8%BD%BD%E5%8D%B7%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E5%90%8Eceph%E7%A9%BA%E9%97%B4%E6%B2%A1%E6%9C%89%E9%87%8A%E6%94%BE/</span><br><span class="line"></span><br><span class="line">kubectl get pods --all-namespaces -o=json | jq -c &#x27;.items[] | &#123;name: .metadata.name, namespace: .metadata.namespace, claimName:.spec.volumes[] | select( has (&quot;persistentVolumeClaim&quot;) ).persistentVolumeClaim.claimName &#125;&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">损坏</span><br><span class="line">https://blog.csdn.net/a13568hki/article/details/120264721</span><br><span class="line">https://blog.51cto.com/wendashuai/2493183</span><br><span class="line">https://blog.51cto.com/gravel/2517124</span><br><span class="line">https://programmer.group/detailed-explanation-of-pg-state-of-distributed-storage-ceph.html</span><br><span class="line">https://juejin.cn/post/6844903731784335374</span><br><span class="line">https://www.tangyuecan.com/2020/02/17/%E5%9F%BA%E4%BA%8Ek8s%E6%90%AD%E5%BB%BAceph%E5%88%86%E9%83%A8%E7%BD%B2%E5%AD%98%E5%82%A8/</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">丁辉滴小窝</p>
  <div class="site-description" itemprop="description">记住你要学习，要努力</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">16</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">丁辉滴小窝</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
